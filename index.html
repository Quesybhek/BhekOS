<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="BhekOS 6.0 - Modern web-based operating system">
    <meta name="theme-color" content="#0078d4">
    <title>BhekOS 6.0</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="icons/icon-192.png">
    
    <style>
        /* ==================== CSS RESET & VARIABLES ==================== */
        :root {
            --mica: rgba(20,20,20,0.85);
            --mica-light: rgba(255,255,255,0.08);
            --mica-border: rgba(255,255,255,0.15);
            --accent: #0078d4;
            --accent-hover: #1081dd;
            --font: 'Segoe UI Variable', 'Segoe UI', system-ui, sans-serif;
            --glass: blur(45px) saturate(210%) brightness(110%);
            --taskbar-height: 48px;
            --titlebar-height: 40px;
            --accent-rgb: 0, 120, 212;
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body, html { 
            height: 100%; 
            font-family: var(--font); 
            overflow: hidden; 
            background: #000; 
            color: white; 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        /* ==================== DESKTOP ==================== */
        #desktop { 
            width: 100vw; 
            height: 100vh; 
            position: relative; 
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), 
                        url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&w=2564&q=80') center/cover fixed; 
        }
        
        /* ==================== WINDOWS ==================== */
        .window { 
            position: absolute; 
            background: var(--mica); 
            backdrop-filter: var(--glass); 
            border: 1px solid var(--mica-border); 
            border-radius: 12px; 
            box-shadow: 0 25px 60px rgba(0,0,0,0.6), 0 2px 6px rgba(0,0,0,0.2); 
            display: flex; 
            flex-direction: column; 
            transform: translateZ(0); 
            animation: win-enter 0.3s cubic-bezier(0.1,0.9,0.2,1); 
            min-width: 300px; 
            min-height: 200px; 
        }
        
        @keyframes win-enter { 
            from { opacity: 0; transform: scale(0.9) translateY(20px); } 
        }
        
        .titlebar { 
            height: var(--titlebar-height); 
            padding: 0 12px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            cursor: move; 
            font-size: 13px; 
            font-weight: 500; 
            background: rgba(0,0,0,0.3); 
            border-bottom: 1px solid var(--mica-border); 
            border-radius: 12px 12px 0 0; 
        }
        
        .titlebar-controls { 
            display: flex; 
            gap: 8px; 
        }
        
        .titlebar-controls span { 
            width: 12px; 
            height: 12px; 
            border-radius: 50%; 
            cursor: pointer; 
        }
        
        .minimize { background: #f5b642; }
        .maximize { background: #35cd4b; }
        .close { background: #ed5f5d; }
        
        .view { 
            flex: 1; 
            padding: 16px; 
            background: rgba(0,0,0,0.25); 
            overflow: auto; 
            border-radius: 0 0 12px 12px; 
        }
        
        /* ==================== TASKBAR ==================== */
        .taskbar { 
            position: absolute; 
            bottom: 0; 
            left: 0; 
            width: 100%; 
            height: var(--taskbar-height); 
            background: var(--mica); 
            backdrop-filter: var(--glass); 
            border-top: 1px solid var(--mica-border); 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 0 16px; 
            z-index: 1000; 
        }
        
        .taskbar-center { 
            display: flex; 
            gap: 2px; 
        }
        
        .taskbar-right { 
            display: flex; 
            align-items: center; 
            gap: 16px; 
        }
        
        .taskbar-icon { 
            width: 36px; 
            height: 36px; 
            border-radius: 6px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 18px; 
            cursor: pointer; 
            transition: 0.2s; 
            position: relative; 
        }
        
        .taskbar-icon:hover { 
            background: rgba(255,255,255,0.1); 
        }
        
        .taskbar-icon.active { 
            background: rgba(255,255,255,0.15); 
        }
        
        .taskbar-icon.active::after { 
            content: ''; 
            position: absolute; 
            bottom: 0; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 20px; 
            height: 2px; 
            background: var(--accent); 
            border-radius: 1px; 
        }
        
        .system-tray { 
            display: flex; 
            gap: 8px; 
            align-items: center; 
            font-size: 12px; 
        }
        
        .system-tray .icon { 
            padding: 4px; 
            cursor: pointer; 
            border-radius: 4px; 
        }
        
        .system-tray .icon:hover { 
            background: rgba(255,255,255,0.1); 
        }
        
        /* ==================== START MENU ==================== */
        #startMenu { 
            position: absolute; 
            bottom: var(--taskbar-height); 
            left: 0; 
            width: 420px; 
            height: 600px; 
            background: var(--mica); 
            backdrop-filter: var(--glass); 
            border: 1px solid var(--mica-border); 
            border-radius: 12px 12px 0 0; 
            display: none; 
            flex-direction: column; 
            z-index: 9999; 
            overflow: hidden; 
            box-shadow: 0 -10px 40px rgba(0,0,0,0.4); 
        }
        
        .start-menu-header { 
            padding: 32px; 
            background: linear-gradient(135deg, rgba(var(--accent-rgb),0.2), rgba(0,0,0,0.3)); 
            border-bottom: 1px solid var(--mica-border); 
        }
        
        .start-menu-header h2 { 
            font-size: 28px; 
            font-weight: 300; 
            margin-bottom: 8px; 
        }
        
        .start-menu-header p { 
            opacity: 0.8; 
            font-size: 14px; 
        }
        
        .start-menu-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 12px; 
            padding: 20px; 
        }
        
        .start-menu-item { 
            padding: 16px; 
            background: rgba(255,255,255,0.05); 
            border-radius: 8px; 
            cursor: pointer; 
            transition: 0.2s; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center; 
        }
        
        .start-menu-item:hover { 
            background: rgba(255,255,255,0.1); 
            transform: translateY(-2px); 
        }
        
        .start-menu-item .emoji { 
            font-size: 32px; 
            margin-bottom: 8px; 
        }
        
        /* ==================== DESKTOP ICONS ==================== */
        .desktop-icons { 
            position: absolute; 
            top: 20px; 
            left: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 20px; 
        }
        
        .desktop-icon { 
            width: 80px; 
            padding: 12px 8px; 
            border-radius: 8px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center; 
            cursor: pointer; 
            transition: 0.2s; 
            font-size: 12px; 
            user-select: none; 
            position: absolute; 
        }
        
        .desktop-icon:hover { 
            background: rgba(255,255,255,0.1); 
        }
        
        .desktop-icon.selected { 
            background: rgba(var(--accent-rgb), 0.3); 
        }
        
        /* ==================== CONTEXT MENU ==================== */
        .context-menu { 
            position: absolute; 
            background: var(--mica); 
            backdrop-filter: var(--glass); 
            border: 1px solid var(--mica-border); 
            border-radius: 8px; 
            padding: 6px; 
            display: none; 
            flex-direction: column; 
            min-width: 180px; 
            z-index: 10000; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.3); 
        }
        
        .context-menu-item { 
            padding: 8px 12px; 
            cursor: pointer; 
            border-radius: 4px; 
            font-size: 13px; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .context-menu-item:hover { 
            background: rgba(255,255,255,0.1); 
        }
        
        /* ==================== NOTIFICATION ==================== */
        .notification { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            background: var(--mica); 
            backdrop-filter: var(--glass); 
            padding: 16px; 
            margin-bottom: 10px; 
            border-radius: 10px; 
            border: 1px solid var(--mica-border); 
            max-width: 300px; 
            z-index: 10000; 
            animation: slideIn 0.3s ease; 
        }
        
        @keyframes slideIn { 
            from { transform: translateX(100%); opacity: 0; } 
            to { transform: translateX(0); opacity: 1; } 
        }
        
        @keyframes fadeout { 
            0% { opacity: 1; } 
            80% { opacity: 1; } 
            100% { opacity: 0; } 
        }
        
        .notification.fadeout { 
            animation: fadeout 3s forwards; 
        }
        
        /* ==================== UI COMPONENTS ==================== */
        button { 
            background: var(--accent); 
            color: #fff; 
            border: none; 
            padding: 8px 16px; 
            cursor: pointer; 
            border-radius: 6px; 
            font-family: var(--font); 
            font-size: 14px; 
            transition: 0.2s; 
        }
        
        button:hover { 
            background: var(--accent-hover); 
            transform: translateY(-1px); 
        }
        
        button.secondary { 
            background: rgba(255,255,255,0.1); 
        }
        
        input, select, textarea { 
            background: rgba(255,255,255,0.1); 
            border: 1px solid var(--mica-border); 
            border-radius: 6px; 
            padding: 8px 12px; 
            color: white; 
            font-family: var(--font); 
            font-size: 14px; 
        }
        
        input:focus, select:focus, textarea:focus { 
            outline: none; 
            border-color: var(--accent); 
        }
        
        /* ==================== FILE EXPLORER ==================== */
        .file-explorer { 
            display: flex; 
            height: 100%; 
        }
        
        .sidebar { 
            width: 200px; 
            background: rgba(0,0,0,0.2); 
            padding: 16px; 
            border-right: 1px solid var(--mica-border); 
        }
        
        .sidebar-item { 
            padding: 8px 12px; 
            border-radius: 6px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            margin-bottom: 4px; 
        }
        
        .sidebar-item:hover { 
            background: rgba(255,255,255,0.1); 
        }
        
        .sidebar-item.active { 
            background: rgba(var(--accent-rgb), 0.2); 
        }
        
        .content { 
            flex: 1; 
            padding: 16px; 
        }
        
        .file-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
            gap: 12px; 
        }
        
        .file-item { 
            padding: 12px; 
            border-radius: 8px; 
            cursor: pointer; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center; 
        }
        
        .file-item:hover { 
            background: rgba(255,255,255,0.1); 
        }
        
        .file-item .icon { 
            font-size: 32px; 
            margin-bottom: 8px; 
        }
        
        /* ==================== TERMINAL ==================== */
        .terminal { 
            background: rgba(0,0,0,0.8); 
            color: #00ff00; 
            font-family: 'Cascadia Code', 'Consolas', monospace; 
            font-size: 14px; 
            padding: 16px; 
            border-radius: 6px; 
            height: 100%; 
            overflow-y: auto; 
        }
        
        .terminal-input { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .prompt { 
            color: #00ffff; 
        }
        
        .cursor { 
            animation: blink 1s infinite; 
        }
        
        @keyframes blink { 
            0%, 50% { opacity: 1; } 
            51%, 100% { opacity: 0; } 
        }
        
        /* ==================== SETTINGS ==================== */
        .settings-grid { 
            display: grid; 
            grid-template-columns: 200px 1fr; 
            gap: 24px; 
        }
        
        .settings-nav { 
            display: flex; 
            flex-direction: column; 
            gap: 4px; 
        }
        
        .settings-nav-item { 
            padding: 12px; 
            border-radius: 6px; 
            cursor: pointer; 
        }
        
        .settings-nav-item:hover { 
            background: rgba(255,255,255,0.1); 
        }
        
        .settings-nav-item.active { 
            background: rgba(var(--accent-rgb), 0.2); 
        }
        
        .settings-content { 
            padding: 16px; 
        }
        
        /* ==================== GAMES ==================== */
        .game-card { 
            background: rgba(255,255,255,0.05); 
            border: 1px solid var(--mica-border); 
            border-radius: 12px; 
            padding: 20px; 
            cursor: pointer; 
            transition: transform 0.2s; 
            text-align: center; 
        }
        
        .game-card:hover { 
            transform: translateY(-5px); 
            background: rgba(255,255,255,0.1); 
        }
        
        /* ==================== GAME CANVASES ==================== */
        .game-canvas { 
            background: #111; 
            border-radius: 8px; 
            display: block; 
            margin: 10px auto; 
            border: 2px solid var(--mica-border); 
        }
        
        /* ==================== MEDIA PLAYER ==================== */
        .media-player { 
            text-align: center; 
        }
        
        .media-controls { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 16px; 
            margin: 20px 0; 
        }
        
        .progress-bar { 
            width: 100%; 
            height: 4px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 2px; 
            margin: 20px 0; 
        }
        
        .progress { 
            width: 30%; 
            height: 100%; 
            background: var(--accent); 
            border-radius: 2px; 
        }
        
        /* ==================== AI CHAT ==================== */
        .ai-chat { 
            height: 300px; 
            overflow-y: auto; 
            background: rgba(0,0,0,0.8); 
            padding: 16px; 
            border-radius: 8px; 
            margin-bottom: 16px; 
        }
        
        .ai-message { 
            margin-bottom: 12px; 
            padding: 8px 12px; 
            border-radius: 8px; 
            max-width: 80%; 
        }
        
        .ai-user { 
            background: rgba(var(--accent-rgb), 0.3); 
            margin-left: auto; 
        }
        
        .ai-bot { 
            background: rgba(255,255,255,0.1); 
        }
        
        /* ==================== SHUTDOWN SCREEN ==================== */
        #shutdown-screen { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100vw; 
            height: 100vh; 
            background: linear-gradient(135deg, #000428, #004e92); 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 99999; 
            font-family: var(--font); 
            color: white; 
            animation: fadeIn 0.5s ease; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; } 
            to { opacity: 1; } 
        }
        
        .shutdown-options { 
            display: flex; 
            gap: 20px; 
            margin-top: 40px; 
        }
        
        .shutdown-options button { 
            padding: 12px 24px; 
            font-size: 16px; 
            border-radius: 8px; 
            border: none; 
            cursor: pointer; 
            transition: transform 0.2s; 
            min-width: 120px; 
        }
        
        .shutdown-options button:hover { 
            transform: scale(1.05); 
        }
        
        /* ==================== LOCK SCREEN ==================== */
        #lock-screen { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100vw; 
            height: 100vh; 
            background: linear-gradient(135deg, #000428, #004e92); 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 99998; 
            font-family: var(--font); 
            color: white; 
        }
        
        /* ==================== PASSWORD PROTECTION ==================== */
        .password-prompt { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: var(--mica); 
            backdrop-filter: var(--glass); 
            border: 1px solid var(--mica-border); 
            border-radius: 12px; 
            padding: 24px; 
            z-index: 10001; 
            min-width: 300px; 
            text-align: center; 
        }
        
        /* ==================== APPLE-LIKE SETTINGS ==================== */
        .apple-settings-item { 
            padding: 15px; 
            border-bottom: 1px solid var(--mica-border); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            cursor: pointer; 
            transition: background 0.2s; 
        }
        
        .apple-settings-item:hover { 
            background: rgba(255,255,255,0.05); 
        }
        
        .apple-settings-item:last-child { 
            border-bottom: none; 
        }
        
        .settings-toggle { 
            position: relative; 
            display: inline-block; 
            width: 44px; 
            height: 24px; 
        }
        
        .settings-toggle input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        
        .settings-slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: rgba(255,255,255,0.2); 
            transition: .4s; 
            border-radius: 24px; 
        }
        
        .settings-slider:before { 
            position: absolute; 
            content: ""; 
            height: 16px; 
            width: 16px; 
            left: 4px; 
            bottom: 4px; 
            background-color: white; 
            transition: .4s; 
            border-radius: 50%; 
        }
        
        input:checked + .settings-slider { 
            background-color: var(--accent); 
        }
        
        input:checked + .settings-slider:before { 
            transform: translateX(20px); 
        }
        
        /* ==================== SECURITY INDICATORS ==================== */
        .security-indicator { 
            display: inline-block; 
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
            margin-right: 8px; 
        }
        
        .security-high { background: #4CAF50; }
        .security-medium { background: #FF9800; }
        .security-low { background: #FF5252; }
        
        /* ==================== INSTALL PROMPT ==================== */
        #install-prompt { 
            position: fixed; 
            bottom: 80px; 
            right: 20px; 
            background: var(--mica); 
            backdrop-filter: var(--glass); 
            border: 1px solid var(--mica-border); 
            border-radius: 12px; 
            padding: 16px; 
            z-index: 10000; 
            max-width: 300px; 
            animation: slideIn 0.3s ease; 
            display: none; 
        }
        
        /* ==================== MOBILE OPTIMIZATIONS ==================== */
        @media (max-width: 768px) {
            .window { 
                width: 95vw !important; 
                height: 80vh !important; 
                left: 2.5vw !important; 
                top: 10vh !important; 
            }
            
            .taskbar { height: 56px; }
            #startMenu { width: 100vw; height: 70vh; }
            .desktop-icons { gap: 10px; }
            .desktop-icon { width: 70px; }
        }
        
        /* ==================== GAME-SPECIFIC STYLES ==================== */
        .memory-card { 
            width: 80px; 
            height: 100px; 
            background: rgba(var(--accent-rgb), 0.3); 
            border-radius: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 32px; 
            cursor: pointer; 
            transition: all 0.3s; 
            transform-style: preserve-3d; 
        }
        
        .memory-card.flipped { background: rgba(255,255,255,0.1); transform: rotateY(180deg); }
        .memory-card.matched { background: rgba(76, 175, 80, 0.3); cursor: default; }
        
        /* 2048 Game */
        .game-2048-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 10px; 
            background: rgba(255,255,255,0.1); 
            padding: 10px; 
            border-radius: 8px; 
            margin: 20px auto; 
            max-width: 400px; 
        }
        
        .tile { 
            width: 80px; 
            height: 80px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 24px; 
            font-weight: bold; 
            border-radius: 6px; 
            color: white; 
        }
        
        /* Puzzle Game */
        .puzzle-container { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 4px; 
            margin: 20px auto; 
            max-width: 300px; 
        }
        
        .puzzle-piece { 
            width: 94px; 
            height: 94px; 
            background: rgba(var(--accent-rgb), 0.3); 
            border-radius: 6px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 24px; 
            cursor: pointer; 
            transition: all 0.2s; 
        }
        
        .puzzle-piece.empty { background: transparent; cursor: default; }
        
        /* Tic Tac Toe */
        .tic-tac-toe-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 4px; 
            background: rgba(255,255,255,0.1); 
            padding: 4px; 
            border-radius: 8px; 
            margin: 20px auto; 
            max-width: 300px; 
        }
        
        .ttt-cell { 
            width: 94px; 
            height: 94px; 
            background: rgba(0,0,0,0.3); 
            border-radius: 6px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 36px; 
            cursor: pointer; 
            transition: all 0.2s; 
        }
        
        .ttt-cell:hover { background: rgba(255,255,255,0.1); }
        
        /* Install Instructions */
        .install-instructions {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--mica);
            backdrop-filter: var(--glass);
            border: 1px solid var(--mica-border);
            border-radius: 12px;
            padding: 24px;
            z-index: 10002;
            max-width: 400px;
            display: none;
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <!-- ==================== DESKTOP CONTAINER ==================== -->
    <div id="desktop" oncontextmenu="os.showContextMenu(event)">
        <!-- Desktop Icons Container -->
        <div class="desktop-icons" id="desktopIcons"></div>
        
        <!-- Taskbar -->
        <div class="taskbar">
            <!-- Start Button -->
            <div class="taskbar-icon" onclick="os.toggleStart()">
                üü¢
            </div>
            
            <!-- Running Apps -->
            <div class="taskbar-center" id="runningApps"></div>
            
            <!-- System Tray -->
            <div class="taskbar-right">
                <div class="system-tray">
                    <div class="icon" title="Wi-Fi">üì∂</div>
                    <div class="icon" title="Volume">üîä</div>
                    <div class="icon" title="Battery">üîã</div>
                    <div id="clock" class="clock">00:00</div>
                </div>
            </div>
        </div>
        
        <!-- Start Menu -->
        <div id="startMenu"></div>
        
        <!-- Context Menu -->
        <div id="contextMenu" class="context-menu"></div>
        
        <!-- Shutdown Screen -->
        <div id="shutdown-screen" style="display: none;"></div>
        
        <!-- Lock Screen -->
        <div id="lock-screen" style="display: none;"></div>
        
        <!-- Install Prompt -->
        <div id="install-prompt" style="display: none;"></div>
        
        <!-- Install Instructions -->
        <div id="install-instructions" class="install-instructions"></div>
    </div>

    <!-- ==================== JAVASCRIPT ==================== -->
    <script>
        // ==================== BHEKOS 6.0 CORE ====================
        const BHEKOS_VERSION = "6.0.0";
        const BHEKOS_BUILD = "22000.556";
        
        class BhekOS {
            constructor() {
                this.procs = new Map(); // Running processes
                this.zIdx = 1000; // Z-index counter
                this.selectedDesktopIcon = null;
                this.wallpaper = localStorage.getItem('wallpaper') || 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&w=2564&q=80';
                this.autoLockTimer = null;
                this.inactivityTimer = null;
                this.deferredPrompt = null;
                this.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                this.currentUser = localStorage.getItem('currentUser') || 'Administrator';
                this.fileSystem = new FileSystem();
                
                // Initialize system
                this.initSystem();
            }
            
            // ==================== SYSTEM INITIALIZATION ====================
            initSystem() {
                // Set wallpaper
                document.getElementById('desktop').style.backgroundImage = 
                    `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), url('${this.wallpaper}') center/cover fixed`;
                
                // Initialize settings
                this.initIconSettingsIfNeeded();
                this.initSecuritySettingsIfNeeded();
                this.initStartMenu();
                this.initDesktopIcons();
                this.updateClock();
                
                // Set up intervals
                setInterval(() => this.updateClock(), 1000);
                this.resetAutoLockTimer();
                this.resetInactivityTimer();
                
                // PWA Install Prompt
                this.setupPWAInstall();
                
                // Show welcome notifications
                setTimeout(() => this.notify('BhekOS 6.0', 'System initialized and ready'), 1000);
                setTimeout(() => this.notify('Security', 'Password protection available in Settings'), 2000);
                
                // Prevent default context menu
                document.addEventListener('contextmenu', e => e.preventDefault());
                
                // Set up inactivity monitoring
                this.setupInactivityMonitoring();
                
                // Check if system should start locked
                this.checkAutoLockOnStart();
                
                // Load PWA service worker
                this.registerServiceWorker();
                
                // Show install prompt after 5 seconds
                setTimeout(() => this.showInstallPrompt(), 5000);
            }
            
            // ==================== FILE SYSTEM ====================
            class FileSystem {
                constructor() {
                    this.files = {
                        'Documents': {
                            type: 'folder',
                            children: {
                                'Work': {
                                    type: 'folder',
                                    children: {
                                        'Report.docx': {type: 'file', size: '2.4 MB'},
                                        'Presentation.pptx': {type: 'file', size: '5.1 MB'}
                                    }
                                },
                                'Personal': {
                                    type: 'folder',
                                    children: {
                                        'Notes.txt': {type: 'file', size: '12 KB'},
                                        'Budget.xlsx': {type: 'file', size: '1.8 MB'}
                                    }
                                }
                            }
                        },
                        'Pictures': {
                            type: 'folder',
                            children: {
                                'Vacation': {
                                    type: 'folder',
                                    children: {
                                        'beach.jpg': {type: 'file', size: '3.2 MB'},
                                        'mountains.png': {type: 'file', size: '4.5 MB'}
                                    }
                                }
                            }
                        },
                        'Downloads': {
                            type: 'folder',
                            children: {}
                        },
                        'Music': {
                            type: 'folder',
                            children: {
                                'Playlist.m3u': {type: 'file', size: '2 KB'}
                            }
                        },
                        'Videos': {
                            type: 'folder',
                            children: {}
                        }
                    };
                    this.currentPath = ['Desktop'];
                    this.clipboard = null;
                }
                
                getCurrentFolder() {
                    let folder = this.files;
                    for (const segment of this.currentPath) {
                        if (folder[segment] && folder[segment].type === 'folder') {
                            folder = folder[segment].children;
                        }
                    }
                    return folder;
                }
                
                navigateTo(path) {
                    const current = this.getCurrentFolder();
                    if (current[path] && current[path].type === 'folder') {
                        this.currentPath.push(path);
                        return true;
                    }
                    return false;
                }
                
                goBack() {
                    if (this.currentPath.length > 1) {
                        this.currentPath.pop();
                        return true;
                    }
                    return false;
                }
                
                getPathString() {
                    return this.currentPath.join(' \\ ');
                }
                
                createFile(name, type = 'file') {
                    const folder = this.getCurrentFolder();
                    if (!folder[name]) {
                        folder[name] = {
                            type: type,
                            size: type === 'folder' ? '--' : '0 KB',
                            created: new Date().toLocaleString()
                        };
                        if (type === 'folder') {
                            folder[name].children = {};
                        }
                        return true;
                    }
                    return false;
                }
                
                deleteFile(name) {
                    const folder = this.getCurrentFolder();
                    if (folder[name]) {
                        delete folder[name];
                        return true;
                    }
                    return false;
                }
                
                copyFile(name) {
                    const folder = this.getCurrentFolder();
                    if (folder[name]) {
                        this.clipboard = { action: 'copy', data: folder[name], name: name };
                        return true;
                    }
                    return false;
                }
                
                pasteFile() {
                    if (!this.clipboard) return false;
                    
                    const folder = this.getCurrentFolder();
                    if (this.clipboard.action === 'copy') {
                        const newName = `Copy of ${this.clipboard.name}`;
                        folder[newName] = JSON.parse(JSON.stringify(this.clipboard.data));
                        return newName;
                    }
                    return false;
                }
                
                searchFiles(query) {
                    const results = [];
                    const searchRecursive = (folder, path) => {
                        for (const [name, file] of Object.entries(folder)) {
                            if (name.toLowerCase().includes(query.toLowerCase())) {
                                results.push({ name, file, path: [...path, name].join(' \\ ') });
                            }
                            if (file.type === 'folder' && file.children) {
                                searchRecursive(file.children, [...path, name]);
                            }
                        }
                    };
                    searchRecursive(this.files, []);
                    return results;
                }
            }
            
            // ==================== DESKTOP ICONS ====================
            initDesktopIcons() {
                const icons = [
                    { id: 'explorer', name: 'File Explorer', defaultEmoji: 'üìÅ', defaultColor: '#4CAF50' },
                    { id: 'terminal', name: 'Terminal', defaultEmoji: 'üíª', defaultColor: '#2196F3' },
                    { id: 'browser', name: 'Web Browser', defaultEmoji: 'üåê', defaultColor: '#FF9800' },
                    { id: 'media', name: 'Media Player', defaultEmoji: 'üéµ', defaultColor: '#9C27B0' },
                    { id: 'settings', name: 'Settings', defaultEmoji: '‚öôÔ∏è', defaultColor: '#607D8B' },
                    { id: 'games', name: 'Game Center', defaultEmoji: 'üéÆ', defaultColor: '#E91E63' },
                    { id: 'ai', name: 'BhekAI', defaultEmoji: 'ü§ñ', defaultColor: '#00BCD4' },
                    { id: 'notepad', name: 'Notepad', defaultEmoji: 'üìù', defaultColor: '#009688' },
                    { id: 'calculator', name: 'Calculator', defaultEmoji: 'üßÆ', defaultColor: '#FF5722' },
                    { id: 'paint', name: 'Paint', defaultEmoji: 'üé®', defaultColor: '#8BC34A' }
                ];
                
                const container = document.getElementById('desktopIcons');
                container.innerHTML = '';
                
                const savedLayout = JSON.parse(localStorage.getItem('desktopLayout') || '{}');
                const savedSettings = JSON.parse(localStorage.getItem('iconSettings') || '{}');
                
                icons.forEach((ic, index) => {
                    const div = document.createElement('div');
                    div.className = 'desktop-icon';
                    div.id = `desktop-${ic.id}`;
                    
                    // Use saved position or grid position
                    const savedPos = savedLayout[ic.id];
                    const gridX = 20 + (index % 3) * 100;
                    const gridY = 20 + Math.floor(index / 3) * 100;
                    
                    div.style.position = 'absolute';
                    div.style.left = (savedPos?.left || gridX) + 'px';
                    div.style.top = (savedPos?.top || gridY) + 'px';
                    
                    // Get custom icon settings
                    const settings = savedSettings[ic.id];
                    const emoji = settings?.emoji || ic.defaultEmoji;
                    const color = settings?.color || ic.defaultColor;
                    const size = settings?.size || 32;
                    const bgOpacity = settings?.bgOpacity || 20;
                    
                    // Calculate background color with opacity
                    const hexColor = color.startsWith('#') ? color : `#${color}`;
                    const opacity = Math.round(bgOpacity * 2.55).toString(16).padStart(2, '0');
                    const bgColor = `${hexColor}${opacity}`;
                    
                    div.innerHTML = `
                        <div class="icon-emoji" style="
                            font-size: ${size}px;
                            width: 64px;
                            height: 64px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            background: ${bgColor};
                            border-radius: 12px;
                            margin-bottom: 4px;
                        ">${emoji}</div>
                        <div class="icon-name" style="
                            font-size: 12px;
                            text-align: center;
                            max-width: 80px;
                            word-wrap: break-word;
                            line-height: 1.2;
                        ">${ic.name}</div>
                    `;
                    
                    // Double-click to launch (with security check)
                    div.ondblclick = () => {
                        if (this.requiresPasswordForApp(ic.id)) {
                            this.showAppPasswordPrompt(ic.id, ic.name);
                        } else {
                            this.spawn(ic.name, ic.id);
                        }
                    };
                    
                    // Single click to select
                    div.onclick = (e) => {
                        e.stopPropagation();
                        this.selectDesktopIcon(ic.id);
                    };
                    
                    // Right-click context menu
                    div.oncontextmenu = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.showDesktopContextMenu(e, ic);
                    };
                    
                    // Drag functionality
                    this.setupIconDrag(div, ic, gridX, gridY);
                    
                    container.appendChild(div);
                });
            }
            
            setupIconDrag(div, icon, gridX, gridY) {
                let isDragging = false;
                let startX, startY, startLeft, startTop;
                
                div.onmousedown = (e) => {
                    if (e.button !== 0) return;
                    if (e.detail > 1) return;
                    
                    this.selectDesktopIcon(icon.id);
                    
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startLeft = parseInt(div.style.left) || gridX;
                    startTop = parseInt(div.style.top) || gridY;
                    
                    div.style.zIndex = '1000';
                    div.style.opacity = '0.8';
                    
                    const onMouseMove = (moveEvent) => {
                        if (!isDragging) return;
                        
                        const dx = moveEvent.clientX - startX;
                        const dy = moveEvent.clientY - startY;
                        
                        div.style.left = (startLeft + dx) + 'px';
                        div.style.top = (startTop + dy) + 'px';
                    };
                    
                    const onMouseUp = () => {
                        isDragging = false;
                        div.style.zIndex = '';
                        div.style.opacity = '';
                        
                        // Snap to grid (20px grid)
                        const left = parseInt(div.style.left);
                        const top = parseInt(div.style.top);
                        
                        div.style.left = Math.round(left / 20) * 20 + 'px';
                        div.style.top = Math.round(top / 20) * 20 + 'px';
                        
                        // Save position
                        this.saveDesktopIconPosition(icon.id, div.style.left, div.style.top);
                        
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                    };
                    
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp, { once: true });
                };
            }
            
            saveDesktopIconPosition(type, left, top) {
                const layout = JSON.parse(localStorage.getItem('desktopLayout') || '{}');
                layout[type] = { left: parseInt(left), top: parseInt(top) };
                localStorage.setItem('desktopLayout', JSON.stringify(layout));
            }
            
            selectDesktopIcon(type) {
                if (this.selectedDesktopIcon) {
                    const prev = document.getElementById(`desktop-${this.selectedDesktopIcon}`);
                    if (prev) prev.classList.remove('selected');
                }
                this.selectedDesktopIcon = type;
                const current = document.getElementById(`desktop-${type}`);
                if (current) current.classList.add('selected');
            }
            
            // ==================== START MENU ====================
            initStartMenu() {
                const menu = document.getElementById('startMenu');
                const apps = [
                    { name: 'File Explorer', emoji: 'üìÅ', type: 'explorer' },
                    { name: 'Terminal', emoji: 'üíª', type: 'terminal' },
                    { name: 'Web Browser', emoji: 'üåê', type: 'browser' },
                    { name: 'Media Player', emoji: 'üéµ', type: 'media' },
                    { name: 'Settings', emoji: '‚öôÔ∏è', type: 'settings' },
                    { name: 'Game Center', emoji: 'üéÆ', type: 'games' },
                    { name: 'BhekAI', emoji: 'ü§ñ', type: 'ai' },
                    { name: 'Notepad', emoji: 'üìù', type: 'notepad' },
                    { name: 'Calculator', emoji: 'üßÆ', type: 'calculator' },
                    { name: 'Paint', emoji: 'üé®', type: 'paint' }
                ];
                
                const savedSettings = JSON.parse(localStorage.getItem('iconSettings') || '{}');
                
                menu.innerHTML = `
                    <div class="start-menu-header">
                        <h2>BhekOS ${BHEKOS_VERSION}</h2>
                        <p>Professional Edition ‚Ä¢ Build ${BHEKOS_BUILD}</p>
                    </div>
                    <div class="start-menu-grid">
                        ${apps.map(app => {
                            const settings = savedSettings[app.type];
                            const emoji = settings?.emoji || app.emoji;
                            const color = settings?.color || '#0078d4';
                            const bgOpacity = settings?.bgOpacity || 20;
                            
                            const opacity = Math.round(bgOpacity * 2.55).toString(16).padStart(2, '0');
                            const bgColor = `${color}${opacity}`;
                            
                            return `
                                <div class="start-menu-item" onclick="os.spawn('${app.name}', '${app.type}'); os.toggleStart()">
                                    <div class="emoji" style="
                                        font-size: 32px;
                                        width: 48px;
                                        height: 48px;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        background: ${bgColor};
                                        border-radius: 10px;
                                        margin-bottom: 8px;
                                    ">${emoji}</div>
                                    <div>${app.name}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div style="margin-top: auto; padding: 20px; background: rgba(0,0,0,0.2); border-top: 1px solid var(--mica-border);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 500;">${this.currentUser}</div>
                                <div style="font-size: 12px; opacity: 0.8;">Administrator</div>
                            </div>
                            <button class="secondary" onclick="os.shutdown()">‚èª Power</button>
                        </div>
                    </div>
                `;
            }
            
            toggleStart() {
                const menu = document.getElementById('startMenu');
                menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
            }
            
            // ==================== WINDOW MANAGEMENT ====================
            spawn(name, type) {
                const pid = 'PID_' + Math.random().toString(36).substr(2, 8).toUpperCase();
                const win = document.createElement('div');
                win.className = 'window';
                win.id = pid;
                
                const left = 100 + (this.procs.size % 5) * 30;
                const top = 50 + (this.procs.size % 5) * 30;
                
                win.style.width = this.isMobile ? '95vw' : '600px';
                win.style.height = this.isMobile ? '70vh' : '500px';
                win.style.left = `${left}px`;
                win.style.top = `${top}px`;
                win.style.zIndex = ++this.zIdx;
                
                win.innerHTML = `
                    <div class="titlebar" onmousedown="os.focus('${pid}'); os.startDrag(event,'${pid}')">
                        <span>${name}</span>
                        <div class="titlebar-controls">
                            <span class="minimize" onclick="os.minimize('${pid}')"></span>
                            <span class="maximize" onclick="os.maximize('${pid}')"></span>
                            <span class="close" onclick="os.kill('${pid}')"></span>
                        </div>
                    </div>
                    <div class="view" id="view-${pid}"></div>
                `;
                
                document.getElementById('desktop').appendChild(win);
                this.procs.set(pid, { win, type, name });
                this.addTaskbar(pid, name);
                this.loadApp(pid, type);
                this.focus(pid);
                this.notify('Application Launched', `${name} is now running`);
            }
            
            addTaskbar(pid, name) {
                const bar = document.getElementById('runningApps');
                const btn = document.createElement('div');
                btn.className = 'taskbar-icon';
                btn.id = 'task-' + pid;
                
                const appId = this.procs.get(pid)?.type;
                const savedSettings = JSON.parse(localStorage.getItem('iconSettings') || '{}');
                const settings = savedSettings[appId];
                
                let iconContent = this.getAppIcon(name);
                if (settings?.emoji) iconContent = settings.emoji;
                
                btn.innerHTML = iconContent;
                btn.title = name;
                btn.onclick = () => {
                    const proc = this.procs.get(pid);
                    if (proc) {
                        this.focus(pid);
                        if (proc.win.style.display === 'none') {
                            proc.win.style.display = 'flex';
                        }
                    }
                };
                
                bar.appendChild(btn);
                return btn;
            }
            
            getAppIcon(name) {
                const iconMap = {
                    'File Explorer': 'üìÅ',
                    'Terminal': 'üíª',
                    'Web Browser': 'üåê',
                    'Media Player': 'üéµ',
                    'Settings': '‚öôÔ∏è',
                    'Game Center': 'üéÆ',
                    'BhekAI': 'ü§ñ',
                    'Notepad': 'üìù',
                    'Calculator': 'üßÆ',
                    'Paint': 'üé®'
                };
                return iconMap[name] || 'üìÑ';
            }
            
            focus(pid) {
                const proc = this.procs.get(pid);
                if (proc) {
                    proc.win.style.zIndex = ++this.zIdx;
                    
                    // Update taskbar
                    document.querySelectorAll('.taskbar-icon').forEach(el => {
                        el.classList.remove('active');
                    });
                    const taskBtn = document.getElementById('task-' + pid);
                    if (taskBtn) taskBtn.classList.add('active');
                    
                    // Bring to front
                    document.getElementById('desktop').appendChild(proc.win);
                }
            }
            
            startDrag(e, pid) {
                const proc = this.procs.get(pid);
                if (!proc) return;
                
                const win = proc.win;
                const startX = e.clientX;
                const startY = e.clientY;
                const startLeft = parseInt(win.style.left) || 100;
                const startTop = parseInt(win.style.top) || 100;
                
                const onMouseMove = (moveEvent) => {
                    const dx = moveEvent.clientX - startX;
                    const dy = moveEvent.clientY - startY;
                    win.style.left = (startLeft + dx) + 'px';
                    win.style.top = (startTop + dy) + 'px';
                };
                
                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                };
                
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp, { once: true });
                
                this.focus(pid);
            }
            
            minimize(pid) {
                const proc = this.procs.get(pid);
                if (proc) {
                    proc.win.style.display = 'none';
                    const taskBtn = document.getElementById('task-' + pid);
                    if (taskBtn) taskBtn.classList.remove('active');
                }
            }
            
            maximize(pid) {
                const proc = this.procs.get(pid);
                if (proc) {
                    const win = proc.win;
                    if (win.style.width === '100vw' && win.style.height === '100vh') {
                        win.style.width = this.isMobile ? '95vw' : '600px';
                        win.style.height = this.isMobile ? '70vh' : '500px';
                        win.style.left = '100px';
                        win.style.top = '50px';
                        win.style.borderRadius = '12px';
                    } else {
                        win.style.width = '100vw';
                        win.style.height = '100vh';
                        win.style.left = '0';
                        win.style.top = '0';
                        win.style.borderRadius = '0';
                    }
                }
            }
            
            kill(pid) {
                const proc = this.procs.get(pid);
                if (proc) {
                    proc.win.remove();
                    this.procs.delete(pid);
                    
                    // Remove from taskbar
                    const taskBtn = document.getElementById('task-' + pid);
                    if (taskBtn) taskBtn.remove();
                    
                    this.notify('Application Closed', `${proc.name} has been closed`);
                }
            }
            
            // ==================== APP LOADERS ====================
            loadApp(pid, type) {
                const view = document.getElementById(`view-${pid}`);
                if (!view) return;
                
                const proc = this.procs.get(pid);
                
                switch(type) {
                    case 'explorer':
                        this.loadFileExplorer(view);
                        break;
                    case 'terminal':
                        this.loadTerminal(view);
                        break;
                    case 'browser':
                        this.loadBrowser(view);
                        break;
                    case 'media':
                        this.loadMediaPlayer(view);
                        break;
                    case 'settings':
                        this.loadSettings(view);
                        break;
                    case 'games':
                        this.loadGames(view);
                        break;
                    case 'ai':
                        this.loadAIChat(view);
                        break;
                    case 'notepad':
                        this.loadNotepad(view);
                        break;
                    case 'calculator':
                        this.loadCalculator(view);
                        break;
                    case 'paint':
                        this.loadPaint(view);
                        break;
                    default:
                        view.innerHTML = `<h3>${proc?.name || 'App'}</h3><p>Application content would load here.</p>`;
                }
            }
            
            // ==================== FILE EXPLORER ====================
            loadFileExplorer(view) {
                const fs = this.fileSystem;
                const currentFolder = fs.getCurrentFolder();
                
                view.innerHTML = `
                    <div class="file-explorer">
                        <div class="sidebar">
                            <div class="sidebar-item active" onclick="os.navigateFileExplorer('Documents')">
                                üìÅ Documents
                            </div>
                            <div class="sidebar-item" onclick="os.navigateFileExplorer('Pictures')">
                                üñºÔ∏è Pictures
                            </div>
                            <div class="sidebar-item" onclick="os.navigateFileExplorer('Downloads')">
                                ‚¨áÔ∏è Downloads
                            </div>
                            <div class="sidebar-item" onclick="os.navigateFileExplorer('Music')">
                                üéµ Music
                            </div>
                            <div class="sidebar-item" onclick="os.navigateFileExplorer('Videos')">
                                üé¨ Videos
                            </div>
                            <div class="sidebar-item" onclick="os.navigateFileExplorer('Desktop')">
                                üñ•Ô∏è Desktop
                            </div>
                            <div class="sidebar-item" onclick="os.navigateFileExplorer('Network')">
                                üîó Network
                            </div>
                            <div style="margin-top: 20px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.8;">Storage</div>
                                <div style="font-size: 11px; margin-top: 4px;">128 GB used of 256 GB</div>
                                <div style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 4px;">
                                    <div style="width: 50%; height: 100%; background: var(--accent); border-radius: 2px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="content">
                            <div style="display: flex; gap: 8px; margin-bottom: 16px; align-items: center;">
                                <button onclick="os.fileExplorerBack()">‚Üê Back</button>
                                <button onclick="os.fileExplorerForward()">‚Üí Forward</button>
                                <button class="secondary" onclick="os.refreshFileExplorer()">‚Üª Refresh</button>
                                <button class="secondary" onclick="os.showNewFileDialog()">+ New</button>
                                <input type="text" placeholder="Search in ${fs.getPathString()}..." 
                                       style="flex: 1; padding: 8px 12px;" id="fileSearch" onkeyup="os.searchFiles(event)">
                            </div>
                            
                            <div style="font-size: 12px; color: rgba(255,255,255,0.7); margin-bottom: 8px; padding: 0 4px;">
                                ${fs.getPathString()}
                            </div>
                            
                            <div class="file-grid" id="fileGrid">
                                ${Object.entries(currentFolder).map(([name, file]) => `
                                    <div class="file-item" oncontextmenu="os.showFileContextMenu(event, '${name}')" 
                                         ondblclick="${file.type === 'folder' ? `os.navigateFileExplorer('${name}')` : `os.openFile('${name}')`}">
                                        <div class="icon">
                                            ${file.type === 'folder' ? 'üìÅ' : 
                                              name.endsWith('.txt') ? 'üìÑ' :
                                              name.endsWith('.jpg') || name.endsWith('.png') ? 'üñºÔ∏è' :
                                              name.endsWith('.mp3') ? 'üéµ' :
                                              name.endsWith('.mp4') ? 'üé¨' :
                                              name.endsWith('.zip') ? 'üì¶' :
                                              name.endsWith('.exe') ? '‚öôÔ∏è' : 'üìÑ'}
                                        </div>
                                        <div style="font-size: 12px; margin-bottom: 4px;">${name}</div>
                                        <div style="font-size: 10px; opacity: 0.7;">${file.size}</div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="margin-top: 20px; padding: 16px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 500;">${Object.keys(currentFolder).length} items</div>
                                        <div style="font-size: 12px; opacity: 0.8;">Total size: ${this.calculateFolderSize(currentFolder)}</div>
                                    </div>
                                    <button onclick="os.showProperties()">Properties</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            navigateFileExplorer(folder) {
                if (this.fileSystem.navigateTo(folder)) {
                    this.refreshFileExplorer();
                }
            }
            
            fileExplorerBack() {
                if (this.fileSystem.goBack()) {
                    this.refreshFileExplorer();
                }
            }
            
            fileExplorerForward() {
                // Implementation for forward navigation
                this.notify('File Explorer', 'Forward navigation');
            }
            
            refreshFileExplorer() {
                const view = document.querySelector('.window.active .view');
                if (view) {
                    this.loadFileExplorer(view);
                }
            }
            
            showNewFileDialog() {
                const type = prompt('Create new: (1) Folder (2) Text File', '1');
                if (type === '1') {
                    const name = prompt('Folder name:');
                    if (name) {
                        this.fileSystem.createFile(name, 'folder');
                        this.refreshFileExplorer();
                        this.notify('File Explorer', `Folder "${name}" created`);
                    }
                } else if (type === '2') {
                    const name = prompt('File name (with extension):', 'newfile.txt');
                    if (name) {
                        this.fileSystem.createFile(name, 'file');
                        this.refreshFileExplorer();
                        this.notify('File Explorer', `File "${name}" created`);
                    }
                }
            }
            
            searchFiles(event) {
                const query = event.target.value;
                if (query.length < 2) return;
                
                const results = this.fileSystem.searchFiles(query);
                const fileGrid = document.getElementById('fileGrid');
                
                if (results.length > 0) {
                    fileGrid.innerHTML = results.map(result => `
                        <div class="file-item" onclick="os.openSearchResult('${result.name}', '${result.path}')">
                            <div class="icon">
                                ${result.file.type === 'folder' ? 'üìÅ' : 'üìÑ'}
                            </div>
                            <div style="font-size: 12px; margin-bottom: 4px;">${result.name}</div>
                            <div style="font-size: 10px; opacity: 0.7;">${result.path}</div>
                        </div>
                    `).join('');
                }
            }
            
            calculateFolderSize(folder) {
                let size = 0;
                for (const [name, file] of Object.entries(folder)) {
                    if (file.type === 'file') {
                        const sizeStr = file.size || '0 KB';
                        const match = sizeStr.match(/([\d.]+)\s*(\w+)/);
                        if (match) {
                            const value = parseFloat(match[1]);
                            const unit = match[2];
                            switch(unit) {
                                case 'GB': size += value * 1024 * 1024 * 1024; break;
                                case 'MB': size += value * 1024 * 1024; break;
                                case 'KB': size += value * 1024; break;
                                default: size += value;
                            }
                        }
                    }
                }
                
                if (size > 1024 * 1024 * 1024) {
                    return (size / (1024 * 1024 * 1024)).toFixed(2) + ' GB';
                } else if (size > 1024 * 1024) {
                    return (size / (1024 * 1024)).toFixed(2) + ' MB';
                } else if (size > 1024) {
                    return (size / 1024).toFixed(2) + ' KB';
                } else {
                    return size + ' bytes';
                }
            }
            
            // ==================== WORKING TERMINAL ====================
            loadTerminal(view) {
                view.innerHTML = `
                    <div class="terminal">
                        <div>BhekOS Terminal ${BHEKOS_VERSION}</div>
                        <div>Type 'help' for available commands</div>
                        <br>
                        <div id="terminal-output">
                            <div>> Welcome to BhekOS Terminal</div>
                            <div>> System ready with enhanced security</div>
                            <div>> Current user: ${this.currentUser}</div>
                            <div>> Type 'help' to see available commands</div>
                            <br>
                        </div>
                        <div class="terminal-input">
                            <span class="prompt">$</span>
                            <input type="text" id="terminal-input" 
                                   style="background: transparent; border: none; color: #00ff00; flex: 1;" 
                                   placeholder="Type command..." 
                                   onkeydown="if(event.key === 'Enter') os.executeTerminalCommand(this.value)">
                        </div>
                    </div>
                `;
            }
            
            executeTerminalCommand(cmd) {
                const output = document.getElementById('terminal-output');
                const input = document.getElementById('terminal-input');
                
                if (!output || !input) return;
                
                // Add command to output
                output.innerHTML += `<div>> ${cmd}</div>`;
                
                // Process command
                const response = this.processCommand(cmd);
                output.innerHTML += `<div>> ${response}</div><br>`;
                
                // Clear input
                input.value = '';
                
                // Scroll to bottom
                output.scrollTop = output.scrollHeight;
            }
            
            processCommand(cmd) {
                const commands = {
                    'help': 'Available commands: help, clear, date, time, ver, lock, shutdown, games, files, users, system',
                    'clear': 'Clearing terminal...',
                    'date': new Date().toLocaleDateString(),
                    'time': new Date().toLocaleTimeString(),
                    'ver': `BhekOS ${BHEKOS_VERSION} Build ${BHEKOS_BUILD}`,
                    'lock': 'Locking system...',
                    'shutdown': 'Initiating shutdown sequence...',
                    'games': 'Available games: snake, flappy, memory, 2048, puzzle, tictactoe',
                    'files': `${Object.keys(this.fileSystem.files).length} folders in root directory`,
                    'users': `Current user: ${this.currentUser}`,
                    'system': 'System status: OK | Memory: 4GB/8GB | CPU: 15%'
                };
                
                if (cmd === 'clear') {
                    setTimeout(() => {
                        const output = document.getElementById('terminal-output');
                        if (output) output.innerHTML = '';
                    }, 100);
                    return 'Terminal cleared';
                }
                
                if (cmd === 'lock') {
                    setTimeout(() => this.lockScreen(), 500);
                    return 'Locking system...';
                }
                
                if (cmd === 'shutdown') {
                    setTimeout(() => this.shutdown(), 500);
                    return 'Initiating shutdown...';
                }
                
                if (cmd.startsWith('cd ')) {
                    const folder = cmd.substring(3);
                    if (this.fileSystem.navigateTo(folder)) {
                        return `Changed directory to ${folder}`;
                    } else {
                        return `Directory not found: ${folder}`;
                    }
                }
                
                if (cmd === 'ls' || cmd === 'dir') {
                    const folder = this.fileSystem.getCurrentFolder();
                    const items = Object.keys(folder).map(name => {
                        const file = folder[name];
                        return `${file.type === 'folder' ? 'üìÅ' : 'üìÑ'} ${name}`;
                    }).join('<br>> ');
                    return items || 'Directory is empty';
                }
                
                if (cmd.startsWith('mkdir ')) {
                    const name = cmd.substring(6);
                    if (this.fileSystem.createFile(name, 'folder')) {
                        return `Folder created: ${name}`;
                    } else {
                        return `Failed to create folder: ${name}`;
                    }
                }
                
                return commands[cmd.toLowerCase()] || `Command not found: ${cmd}. Type 'help' for available commands.`;
            }
            
            // ==================== WORKING WEB BROWSER ====================
            loadBrowser(view) {
                view.innerHTML = `
                    <div style="display: flex; flex-direction: column; height: 100%;">
                        <div class="browser-toolbar" style="display: flex; gap: 8px; padding: 12px; background: rgba(0,0,0,0.2); border-bottom: 1px solid var(--mica-border);">
                            <button onclick="os.browserBack()">‚Üê</button>
                            <button onclick="os.browserForward()">‚Üí</button>
                            <button onclick="os.browserRefresh()">‚Üª</button>
                            <input type="text" class="browser-url" value="https://bhekos.com" placeholder="Enter URL" style="flex: 1;" id="browserUrl">
                            <button onclick="os.browserGo()">Go</button>
                            <button onclick="os.browserNewTab()">+</button>
                        </div>
                        
                        <div style="display: flex; border-bottom: 1px solid var(--mica-border);">
                            <div class="browser-tab active" onclick="os.browserSwitchTab(0)" style="padding: 8px 16px; background: rgba(255,255,255,0.1); border-right: 1px solid var(--mica-border); cursor: pointer;">
                                BhekOS Home
                            </div>
                            <div class="browser-tab" onclick="os.browserSwitchTab(1)" style="padding: 8px 16px; border-right: 1px solid var(--mica-border); cursor: pointer;">
                                New Tab
                            </div>
                        </div>
                        
                        <div id="browser-content" style="flex: 1; background: white; color: black; overflow-y: auto;">
                            <div style="padding: 20px;">
                                <h1>Welcome to BhekOS Browser</h1>
                                <p>This is a built-in web browser for BhekOS 6.0.</p>
                                
                                <h3 style="margin-top: 20px;">Quick Links:</h3>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                                    <button onclick="os.browserLoadURL('https://www.google.com')" style="padding: 10px; background: #f1f1f1; border: none; border-radius: 5px; cursor: pointer;">
                                        üîç Google Search
                                    </button>
                                    <button onclick="os.browserLoadURL('https://github.com')" style="padding: 10px; background: #f1f1f1; border: none; border-radius: 5px; cursor: pointer;">
                                        üíª GitHub
                                    </button>
                                    <button onclick="os.browserLoadURL('https://www.youtube.com')" style="padding: 10px; background: #f1f1f1; border: none; border-radius: 5px; cursor: pointer;">
                                        üé¨ YouTube
                                    </button>
                                    <button onclick="os.browserLoadURL('https://www.wikipedia.org')" style="padding: 10px; background: #f1f1f1; border: none; border-radius: 5px; cursor: pointer;">
                                        üìö Wikipedia
                                    </button>
                                </div>
                                
                                <h3 style="margin-top: 20px;">Features:</h3>
                                <ul>
                                    <li>Secure browsing with password protection</li>
                                    <li>Tab support</li>
                                    <li>Bookmarks</li>
                                    <li>Privacy mode</li>
                                    <li>Download manager</li>
                                </ul>
                                
                                <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                    <h4>Browser Security Status:</h4>
                                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                        <span class="security-indicator security-high"></span>
                                        <span>Connection is secure</span>
                                    </div>
                                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                        Your information (passwords, credit cards) is private when sent to this site
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="padding: 10px; background: rgba(0,0,0,0.1); border-top: 1px solid var(--mica-border); font-size: 12px;">
                            <span id="browser-status">Ready</span>
                        </div>
                    </div>
                `;
            }
            
            browserLoadURL(url) {
                const content = document.getElementById('browser-content');
                const status = document.getElementById('browser-status');
                const urlInput = document.getElementById('browserUrl');
                
                if (!content || !status || !urlInput) return;
                
                urlInput.value = url;
                status.textContent = `Loading ${url}...`;
                
                // Simulate loading
                setTimeout(() => {
                    content.innerHTML = `
                        <div style="padding: 20px;">
                            <h2>Browser Simulation</h2>
                            <p>Loading: ${url}</p>
                            <p>This is a simulated browser. In a real implementation, this would display actual web content.</p>
                            <p>BhekOS Browser includes:</p>
                            <ul>
                                <li>Tab management</li>
                                <li>Bookmarks</li>
                                <li>History</li>
                                <li>Downloads</li>
                                <li>Incognito mode</li>
                            </ul>
                            <button onclick="os.browserBookmark('${url}')" style="margin-top: 20px; padding: 10px 20px; background: var(--accent); color: white; border: none; border-radius: 5px; cursor: pointer;">
                                ‚≠ê Bookmark this page
                            </button>
                        </div>
                    `;
                    status.textContent = `Loaded: ${url}`;
                    this.notify('Browser', `Loaded ${url}`);
                }, 1000);
            }
            
            browserGo() {
                const urlInput = document.getElementById('browserUrl');
                if (urlInput && urlInput.value) {
                    this.browserLoadURL(urlInput.value);
                }
            }
            
            browserBookmark(url) {
                let bookmarks = JSON.parse(localStorage.getItem('browserBookmarks') || '[]');
                if (!bookmarks.includes(url)) {
                    bookmarks.push(url);
                    localStorage.setItem('browserBookmarks', JSON.stringify(bookmarks));
                    this.notify('Browser', 'Page bookmarked!');
                }
            }
            
            // ==================== WORKING MEDIA PLAYER ====================
            loadMediaPlayer(view) {
                view.innerHTML = `
                    <div class="media-player">
                        <h2>üéµ Media Player</h2>
                        
                        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; margin: 20px 0;">
                            <audio id="mediaPlayerAudio" controls style="width: 100%;"></audio>
                            <div id="nowPlaying" style="margin-top: 12px; text-align: center; opacity: 0.8;">
                                No file playing
                            </div>
                        </div>
                        
                        <div class="media-controls">
                            <button onclick="os.mediaPrevious()">‚èÆÔ∏è</button>
                            <button onclick="os.mediaPlayPause()" id="playPauseBtn">‚ñ∂Ô∏è Play</button>
                            <button onclick="os.mediaNext()">‚è≠Ô∏è</button>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <input type="file" id="mediaFileInput" accept="audio/*,video/*" 
                                   style="display: none;" onchange="os.mediaFileSelected(event)">
                            <button onclick="document.getElementById('mediaFileInput').click()" 
                                    style="width: 100%; padding: 12px;">
                                üìÅ Open Media File
                            </button>
                        </div>
                        
                        <div style="margin-top: 30px; padding: 16px; background: rgba(var(--accent-rgb), 0.1); border-radius: 8px;">
                            <h4>üéº Playlist</h4>
                            <div id="playlist" style="margin-top: 12px; max-height: 200px; overflow-y: auto;">
                                <div style="padding: 8px; border-bottom: 1px solid var(--mica-border); cursor: pointer;" onclick="os.mediaLoadSample(1)">
                                    üéµ Sample Track 1 - Ambient Music
                                </div>
                                <div style="padding: 8px; border-bottom: 1px solid var(--mica-border); cursor: pointer;" onclick="os.mediaLoadSample(2)">
                                    üéµ Sample Track 2 - Game Soundtrack
                                </div>
                                <div style="padding: 8px; border-bottom: 1px solid var(--mica-border); cursor: pointer;" onclick="os.mediaLoadSample(3)">
                                    üéµ Sample Track 3 - System Sounds
                                </div>
                            </div>
                            <button onclick="os.mediaCreatePlaylist()" style="margin-top: 12px; width: 100%;">
                                Create New Playlist
                            </button>
                        </div>
                        
                        <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: center;">
                            <button onclick="os.mediaVolume('up')">üîä</button>
                            <button onclick="os.mediaVolume('down')">üîâ</button>
                            <button onclick="os.mediaVolume('mute')">üîá</button>
                        </div>
                    </div>
                `;
            }
            
            mediaPlayPause() {
                const audio = document.getElementById('mediaPlayerAudio');
                const button = document.getElementById('playPauseBtn');
                
                if (audio && button) {
                    if (audio.paused) {
                        audio.play();
                        button.textContent = '‚è∏Ô∏è Pause';
                    } else {
                        audio.pause();
                        button.textContent = '‚ñ∂Ô∏è Play';
                    }
                }
            }
            
            mediaFileSelected(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const audio = document.getElementById('mediaPlayerAudio');
                const nowPlaying = document.getElementById('nowPlaying');
                
                if (audio && nowPlaying) {
                    const url = URL.createObjectURL(file);
                    audio.src = url;
                    nowPlaying.textContent = `Now playing: ${file.name}`;
                    this.notify('Media Player', `Loaded: ${file.name}`);
                }
            }
            
            mediaLoadSample(track) {
                const samples = {
                    1: { name: 'Ambient Music', url: 'https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3' },
                    2: { name: 'Game Soundtrack', url: 'https://assets.mixkit.co/music/preview/mixkit-game-show-suspense-waiting-667.mp3' },
                    3: { name: 'System Sounds', url: 'https://assets.mixkit.co/music/preview/mixkit-simple-tech-2204.mp3' }
                };
                
                const sample = samples[track];
                if (sample) {
                    const audio = document.getElementById('mediaPlayerAudio');
                    const nowPlaying = document.getElementById('nowPlaying');
                    
                    if (audio && nowPlaying) {
                        audio.src = sample.url;
                        nowPlaying.textContent = `Now playing: ${sample.name}`;
                        this.notify('Media Player', `Playing: ${sample.name}`);
                    }
                }
            }
            
            // ==================== COMPREHENSIVE SETTINGS ====================
            loadSettings(view) {
                view.innerHTML = `
                    <div class="settings-grid">
                        <div class="settings-nav">
                            <div class="settings-nav-item active" onclick="os.showSettingsTab('personalization')">
                                üé® Personalization
                            </div>
                            <div class="settings-nav-item" onclick="os.showSettingsTab('icons')">
                                üñºÔ∏è Icon Customization
                            </div>
                            <div class="settings-nav-item" onclick="os.showSettingsTab('security')">
                                üîê Security & Password
                            </div>
                            <div class="settings-nav-item" onclick="os.showSettingsTab('system')">
                                ‚öôÔ∏è System
                            </div>
                            <div class="settings-nav-item" onclick="os.showSettingsTab('network')">
                                üåê Network
                            </div>
                            <div class="settings-nav-item" onclick="os.showSettingsTab('accessibility')">
                                ‚ôø Accessibility
                            </div>
                            <div class="settings-nav-item" onclick="os.showSettingsTab('users')">
                                üë• User Accounts
                            </div>
                            <div class="settings-nav-item" onclick="os.showSettingsTab('about')">
                                ‚ÑπÔ∏è About
                            </div>
                        </div>
                        <div class="settings-content" id="settings-content">
                            <h2 style="margin-bottom: 20px;">üé® Personalization</h2>
                            ${this.getPersonalizationSettings()}
                        </div>
                    </div>
                `;
            }
            
            showSettingsTab(tab) {
                const content = document.getElementById('settings-content');
                document.querySelectorAll('.settings-nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.classList.add('active');
                
                switch(tab) {
                    case 'personalization':
                        content.innerHTML = `<h2 style="margin-bottom: 20px;">üé® Personalization</h2>${this.getPersonalizationSettings()}`;
                        break;
                    case 'icons':
                        content.innerHTML = `<h2 style="margin-bottom: 20px;">üñºÔ∏è Icon Customization</h2>${this.getIconSettings()}`;
                        break;
                    case 'security':
                        content.innerHTML = `<h2 style="margin-bottom: 20px;">üîê Security & Password</h2>${this.getSecuritySettings()}`;
                        break;
                    case 'system':
                        content.innerHTML = `<h2 style="margin-bottom: 20px;">‚öôÔ∏è System</h2>${this.getSystemSettings()}`;
                        break;
                    case 'network':
                        content.innerHTML = `<h2 style="margin-bottom: 20px;">üåê Network</h2>${this.getNetworkSettings()}`;
                        break;
                    case 'accessibility':
                        content.innerHTML = `<h2 style="margin-bottom: 20px;">‚ôø Accessibility</h2>${this.getAccessibilitySettings()}`;
                        break;
                    case 'users':
                        content.innerHTML = `<h2 style="margin-bottom: 20px;">üë• User Accounts</h2>${this.getUserSettings()}`;
                        break;
                    case 'about':
                        content.innerHTML = `<h2 style="margin-bottom: 20px;">‚ÑπÔ∏è About BhekOS</h2>${this.getAboutSettings()}`;
                        break;
                }
            }
            
            getPersonalizationSettings() {
                const wallpaper = localStorage.getItem('wallpaper') || 'default';
                const darkMode = localStorage.getItem('darkMode') !== 'false';
                const transparency = localStorage.getItem('transparency') !== 'false';
                const accent = localStorage.getItem('accentColor') || '#0078d4';
                
                return `
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Dark Mode</div>
                            <div style="font-size: 12px; opacity: 0.8;">Enable dark theme</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" ${darkMode ? 'checked' : ''} onchange="os.toggleDarkMode(this.checked)">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Transparency Effects</div>
                            <div style="font-size: 12px; opacity: 0.8;">Mica and glass effects</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" ${transparency ? 'checked' : ''} onchange="os.toggleTransparency(this.checked)">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Wallpaper</div>
                            <div style="font-size: 12px; opacity: 0.8;">Change desktop background</div>
                        </div>
                        <select onchange="os.changeWallpaper(this.value)" style="width: 150px;">
                            <option value="default" ${wallpaper === 'default' ? 'selected' : ''}>Default</option>
                            <option value="nature" ${wallpaper === 'nature' ? 'selected' : ''}>Nature</option>
                            <option value="abstract" ${wallpaper === 'abstract' ? 'selected' : ''}>Abstract</option>
                            <option value="gradient" ${wallpaper === 'gradient' ? 'selected' : ''}>Gradient</option>
                        </select>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Accent Color</div>
                            <div style="font-size: 12px; opacity: 0.8;">System highlight color</div>
                        </div>
                        <input type="color" value="${accent}" onchange="os.changeAccentColor(this.value)" style="width: 60px; height: 30px;">
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Desktop Icon Size</div>
                            <div style="font-size: 12px; opacity: 0.8;">Size of desktop icons</div>
                        </div>
                        <select onchange="os.changeIconSize(this.value)" style="width: 100px;">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Taskbar Position</div>
                            <div style="font-size: 12px; opacity: 0.8;">Position of taskbar</div>
                        </div>
                        <select onchange="os.changeTaskbarPosition(this.value)" style="width: 120px;">
                            <option value="bottom" selected>Bottom</option>
                            <option value="top">Top</option>
                            <option value="left">Left</option>
                            <option value="right">Right</option>
                        </select>
                    </div>
                `;
            }
            
            getSecuritySettings() {
                const security = JSON.parse(localStorage.getItem('securitySettings') || '{}');
                const requirePassword = security.requirePassword || false;
                const autoLock = security.autoLock || 5;
                const requirePasswordForApps = security.requirePasswordForApps || false;
                
                return `
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Password Protection</div>
                            <div style="font-size: 12px; opacity: 0.8;">Require password to unlock system</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" ${requirePassword ? 'checked' : ''} onchange="os.togglePasswordProtection(this.checked)">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Auto Lock</div>
                            <div style="font-size: 12px; opacity: 0.8;">Lock after inactivity</div>
                        </div>
                        <select onchange="os.changeAutoLock(this.value)" style="width: 120px;">
                            <option value="0" ${autoLock === 0 ? 'selected' : ''}>Never</option>
                            <option value="1" ${autoLock === 1 ? 'selected' : ''}>1 minute</option>
                            <option value="5" ${autoLock === 5 ? 'selected' : ''}>5 minutes</option>
                            <option value="10" ${autoLock === 10 ? 'selected' : ''}>10 minutes</option>
                            <option value="30" ${autoLock === 30 ? 'selected' : ''}>30 minutes</option>
                        </select>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">App Password Protection</div>
                            <div style="font-size: 12px; opacity: 0.8;">Require password for sensitive apps</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" ${requirePasswordForApps ? 'checked' : ''} onchange="os.toggleAppPasswordProtection(this.checked)">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Windows Defender</div>
                            <div style="font-size: 12px; opacity: 0.8;">Built-in antivirus protection</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" checked disabled>
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Firewall</div>
                            <div style="font-size: 12px; opacity: 0.8;">Network firewall protection</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" checked>
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div style="margin-top: 20px; padding: 16px; background: rgba(var(--accent-rgb), 0.1); border-radius: 8px;">
                        <h4>Security Status</h4>
                        <div style="margin-top: 10px;">
                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                <span class="security-indicator security-high"></span>
                                <span>System is secure</span>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                <span class="security-indicator security-high"></span>
                                <span>Windows Defender: Active</span>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <span class="security-indicator security-high"></span>
                                <span>Firewall: Enabled</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            getSystemSettings() {
                return `
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">System Updates</div>
                            <div style="font-size: 12px; opacity: 0.8;">Automatically download and install updates</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" checked>
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Performance Mode</div>
                            <div style="font-size: 12px; opacity: 0.8;">Optimize for performance</div>
                        </div>
                        <select style="width: 120px;">
                            <option>Balanced</option>
                            <option>Power Saver</option>
                            <option>High Performance</option>
                        </select>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Storage Sense</div>
                            <div style="font-size: 12px; opacity: 0.8;">Automatically free up space</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Backup & Recovery</div>
                            <div style="font-size: 12px; opacity: 0.8;">File History and System Restore</div>
                        </div>
                        <button onclick="os.openBackupSettings()">Configure</button>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Display</div>
                            <div style="font-size: 12px; opacity: 0.8;">Resolution and scaling</div>
                        </div>
                        <select style="width: 120px;">
                            <option>1920x1080 (Recommended)</option>
                            <option>1366x768</option>
                            <option>2560x1440</option>
                        </select>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Power & Sleep</div>
                            <div style="font-size: 12px; opacity: 0.8;">Screen timeout and sleep settings</div>
                        </div>
                        <button onclick="os.openPowerSettings()">Configure</button>
                    </div>
                `;
            }
            
            getAccessibilitySettings() {
                return `
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Screen Reader</div>
                            <div style="font-size: 12px; opacity: 0.8;">Narrator for vision impairment</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" onchange="os.toggleNarrator(this.checked)">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Magnifier</div>
                            <div style="font-size: 12px; opacity: 0.8;">Zoom in on screen content</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" onchange="os.toggleMagnifier(this.checked)">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">High Contrast</div>
                            <div style="font-size: 12px; opacity: 0.8;">Increase color contrast</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" onchange="os.toggleHighContrast(this.checked)">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">On-Screen Keyboard</div>
                            <div style="font-size: 12px; opacity: 0.8;">Virtual keyboard for touch input</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Closed Captions</div>
                            <div style="font-size: 12px; opacity: 0.8;">Display captions for media</div>
                        </div>
                        <button onclick="os.configureCaptions()">Configure</button>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Cursor Size</div>
                            <div style="font-size: 12px; opacity: 0.8;">Adjust mouse pointer size</div>
                        </div>
                        <select onchange="os.changeCursorSize(this.value)">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                            <option value="extra-large">Extra Large</option>
                        </select>
                    </div>
                `;
            }
            
            getUserSettings() {
                const users = JSON.parse(localStorage.getItem('bhekosUsers') || '[]');
                if (users.length === 0) {
                    users.push({ name: 'Administrator', type: 'admin', lastLogin: new Date().toLocaleDateString() });
                    users.push({ name: 'Guest', type: 'guest', lastLogin: 'Never' });
                    localStorage.setItem('bhekosUsers', JSON.stringify(users));
                }
                
                return `
                    <div style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 16px;">User Accounts</h3>
                        ${users.map(user => `
                            <div class="apple-settings-item">
                                <div>
                                    <div style="font-weight: 500;">${user.name}</div>
                                    <div style="font-size: 12px; opacity: 0.8;">${user.type === 'admin' ? 'Administrator' : 'Standard User'} ‚Ä¢ Last login: ${user.lastLogin}</div>
                                </div>
                                <button class="secondary" onclick="os.switchUser('${user.name}')">Switch</button>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button onclick="os.addNewUser()" style="width: 100%; padding: 12px;">
                            Ôºã Add New User
                        </button>
                    </div>
                    
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Require Sign-in</div>
                            <div style="font-size: 12px; opacity: 0.8;">When waking from sleep</div>
                        </div>
                        <select style="width: 120px;">
                            <option>Never</option>
                            <option>When PC wakes up</option>
                        </select>
                    </div>
                    
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Dynamic Lock</div>
                            <div style="font-size: 12px; opacity: 0.8;">Lock when you walk away</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                `;
            }
            
            getNetworkSettings() {
                return `
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Wi-Fi</div>
                            <div style="font-size: 12px; opacity: 0.8;">Connected to Network-5G</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox" checked>
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Airplane Mode</div>
                            <div style="font-size: 12px; opacity: 0.8;">Disable all wireless communications</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Mobile Hotspot</div>
                            <div style="font-size: 12px; opacity: 0.8;">Share internet connection</div>
                        </div>
                        <label class="settings-toggle">
                            <input type="checkbox">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">VPN</div>
                            <div style="font-size: 12px; opacity: 0.8;">Virtual private network</div>
                        </div>
                        <button onclick="os.setupVPN()">Add VPN</button>
                    </div>
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Proxy</div>
                            <div style="font-size: 12px; opacity: 0.8;">Manual proxy setup</div>
                        </div>
                        <button onclick="os.setupProxy()">Setup</button>
                    </div>
                    <div style="margin-top: 20px; padding: 16px; background: rgba(var(--accent-rgb), 0.1); border-radius: 8px;">
                        <h4>Network Status</h4>
                        <div style="margin-top: 10px;">
                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                <span class="security-indicator security-high"></span>
                                <span>Internet access: Available</span>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                <span class="security-indicator security-high"></span>
                                <span>Connection type: Wi-Fi</span>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <span class="security-indicator security-medium"></span>
                                <span>Signal strength: Good</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            getAboutSettings() {
                return `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üñ•Ô∏è</div>
                        <h2>BhekOS ${BHEKOS_VERSION}</h2>
                        <p style="opacity: 0.8; margin-bottom: 8px;">Professional Edition</p>
                        <p style="font-size: 12px; opacity: 0.6;">Build ${BHEKOS_BUILD}</p>
                    </div>
                    
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Device Specifications</div>
                            <div style="font-size: 12px; opacity: 0.8;">Hardware information</div>
                        </div>
                        <button onclick="os.showDeviceInfo()">View</button>
                    </div>
                    
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Windows Specifications</div>
                            <div style="font-size: 12px; opacity: 0.8;">Edition, version, and install date</div>
                        </div>
                        <div style="text-align: right;">
                            <div>BhekOS Professional</div>
                            <div style="font-size: 12px; opacity: 0.8;">Version ${BHEKOS_VERSION}</div>
                        </div>
                    </div>
                    
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Support</div>
                            <div style="font-size: 12px; opacity: 0.8;">Get help and contact support</div>
                        </div>
                        <button onclick="os.openSupport()">Contact</button>
                    </div>
                    
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Activation</div>
                            <div style="font-size: 12px; opacity: 0.8;">Windows is activated</div>
                        </div>
                        <div style="color: #4CAF50;">‚úì Activated</div>
                    </div>
                    
                    <div class="apple-settings-item">
                        <div>
                            <div style="font-weight: 500;">Copyright</div>
                            <div style="font-size: 12px; opacity: 0.8;">¬© 2024 BhekOS Corporation</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 16px; background: rgba(var(--accent-rgb), 0.1); border-radius: 8px;">
                        <h4>System Information</h4>
                        <div style="margin-top: 10px; font-size: 13px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                <span>Processor:</span>
                                <span>Intel Core i7-12700K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                <span>Installed RAM:</span>
                                <span>16.0 GB</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                <span>Device ID:</span>
                                <span>BHEK-${Math.random().toString(36).substr(2, 8).toUpperCase()}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>System type:</span>
                                <span>64-bit operating system</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            toggleDarkMode(enabled) {
                localStorage.setItem('darkMode', enabled);
                this.notify('Settings', `Dark mode ${enabled ? 'enabled' : 'disabled'}`);
            }
            
            toggleTransparency(enabled) {
                localStorage.setItem('transparency', enabled);
                document.querySelectorAll('.window, .taskbar, #startMenu').forEach(el => {
                    el.style.backdropFilter = enabled ? 'var(--glass)' : 'none';
                });
                this.notify('Settings', `Transparency effects ${enabled ? 'enabled' : 'disabled'}`);
            }
            
            changeWallpaper(type) {
                const wallpapers = {
                    'default': 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&w=2564&q=80',
                    'nature': 'https://images.unsplash.com/photo-1501854140801-50d01698950b?auto=format&fit=crop&w=2564&q=80',
                    'abstract': 'https://images.unsplash.com/photo-1550684376-efcbd6e3f031?auto=format&fit=crop&w=2564&q=80',
                    'gradient': 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?auto=format&fit=crop&w=2564&q=80'
                };
                
                this.wallpaper = wallpapers[type] || wallpapers.default;
                localStorage.setItem('wallpaper', type);
                document.getElementById('desktop').style.backgroundImage = 
                    `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), url('${this.wallpaper}') center/cover fixed`;
                this.notify('Settings', `Wallpaper changed to ${type}`);
            }
            
            changeAccentColor(color) {
                localStorage.setItem('accentColor', color);
                document.documentElement.style.setProperty('--accent', color);
                document.documentElement.style.setProperty('--accent-hover', this.lightenColor(color, 20));
                this.notify('Settings', `Accent color changed`);
            }
            
            lightenColor(color, percent) {
                const num = parseInt(color.slice(1), 16);
                const amt = Math.round(2.55 * percent);
                const R = (num >> 16) + amt;
                const G = (num >> 8 & 0x00FF) + amt;
                const B = (num & 0x0000FF) + amt;
                return `#${(0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                    (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                    (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1)}`;
            }
            
            // ==================== GAMES ====================
            loadGames(view) {
                view.innerHTML = `
                    <div style="padding: 20px; height: 100%; overflow-y: auto;">
                        <h2 style="margin-bottom: 20px;">üéÆ Game Center</h2>
                        <p style="margin-bottom: 20px; opacity: 0.8;">Select a game to play. All games feature password protection.</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; margin-top: 20px;">
                            <div class="game-card" onclick="os.launchGame('snake')">
                                <div style="font-size: 48px; margin-bottom: 12px;">üêç</div>
                                <h3 style="margin-bottom: 8px;">Snake</h3>
                                <p style="font-size: 12px; opacity: 0.8;">Classic snake game</p>
                            </div>
                            
                            <div class="game-card" onclick="os.launchGame('flappy')">
                                <div style="font-size: 48px; margin-bottom: 12px;">üê¶</div>
                                <h3 style="margin-bottom: 8px;">Flappy Bird</h3>
                                <p style="font-size: 12px; opacity: 0.8;">Fly through pipes</p>
                            </div>
                            
                            <div class="game-card" onclick="os.launchGame('memory')">
                                <div style="font-size: 48px; margin-bottom: 12px;">üß†</div>
                                <h3 style="margin-bottom: 8px;">Memory Match</h3>
                                <p style="font-size: 12px; opacity: 0.8;">Test your memory</p>
                            </div>
                            
                            <div class="game-card" onclick="os.launchGame('2048')">
                                <div style="font-size: 48px; margin-bottom: 12px;">üßÆ</div>
                                <h3 style="margin-bottom: 8px;">2048</h3>
                                <p style="font-size: 12px; opacity: 0.8;">Slide and combine numbers</p>
                            </div>
                            
                            <div class="game-card" onclick="os.launchGame('puzzle')">
                                <div style="font-size: 48px; margin-bottom: 12px;">üß©</div>
                                <h3 style="margin-bottom: 8px;">Puzzle</h3>
                                <p style="font-size: 12px; opacity: 0.8;">Slide puzzle game</p>
                            </div>
                            
                            <div class="game-card" onclick="os.launchGame('tic-tac-toe')">
                                <div style="font-size: 48px; margin-bottom: 12px;">‚≠ï</div>
                                <h3 style="margin-bottom: 8px;">Tic Tac Toe</h3>
                                <p style="font-size: 12px; opacity: 0.8;">Play against AI</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; padding: 16px; background: rgba(var(--accent-rgb), 0.1); border-radius: 8px;">
                            <h4>üîê Game Security</h4>
                            <p style="font-size: 13px; margin-top: 8px;">All games are protected with BhekOS security features.</p>
                            <label style="display: flex; align-items: center; gap: 8px; margin-top: 12px;">
                                <input type="checkbox" id="game-passwords" onchange="os.toggleGamePasswords(this.checked)">
                                Require password for games
                            </label>
                        </div>
                        
                        <div style="margin-top: 20px; font-size: 12px; opacity: 0.6; text-align: center;">
                            High scores are encrypted and saved locally
                        </div>
                    </div>
                `;
            }
            
            launchGame(gameType) {
                const security = JSON.parse(localStorage.getItem('securitySettings') || '{}');
                if (security.requirePasswordForGames) {
                    this.showGamePasswordPrompt(gameType);
                    return;
                }
                
                const gameNames = {
                    'snake': 'Snake Game',
                    'flappy': 'Flappy Bird',
                    'memory': 'Memory Match',
                    '2048': '2048',
                    'puzzle': 'Puzzle Game',
                    'tic-tac-toe': 'Tic Tac Toe'
                };
                
                this.spawn(gameNames[gameType] || 'Game', 'games');
                
                setTimeout(() => {
                    const view = document.querySelector('.window:last-child .view');
                    if (view) {
                        this.loadSpecificGame(gameType, view);
                    }
                }, 100);
            }
            
            loadSpecificGame(gameType, view) {
                switch(gameType) {
                    case 'snake':
                        this.loadSnakeGame(view);
                        break;
                    case 'flappy':
                        this.loadFlappyBird(view);
                        break;
                    case 'memory':
                        this.loadMemoryGame(view);
                        break;
                    case '2048':
                        this.load2048Game(view);
                        break;
                    case 'puzzle':
                        this.loadPuzzleGame(view);
                        break;
                    case 'tic-tac-toe':
                        this.loadTicTacToe(view);
                        break;
                    default:
                        view.innerHTML = `<p>Game not found</p>`;
                }
            }
            
            // ==================== AI CHAT ====================
            loadAIChat(view) {
                view.innerHTML = `
                    <div style="display: flex; flex-direction: column; height: 100%;">
                        <h2 style="margin-bottom: 16px;">ü§ñ BhekAI Assistant</h2>
                        <p style="margin-bottom: 16px; opacity: 0.8;">Ask me anything about BhekOS or get help with tasks.</p>
                        
                        <div class="ai-chat" id="aiChat">
                            <div class="ai-message ai-bot">
                                Hello! I'm BhekAI, your virtual assistant. How can I help you today?
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 8px; margin-top: 16px;">
                            <input type="text" id="aiInput" placeholder="Type your message..." 
                                   style="flex: 1;" onkeydown="if(event.key === 'Enter') os.sendAIMessage()">
                            <button onclick="os.sendAIMessage()">Send</button>
                        </div>
                        
                        <div style="margin-top: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="secondary" onclick="os.aiQuickQuestion('How do I change my wallpaper?')">Change Wallpaper</button>
                            <button class="secondary" onclick="os.aiQuickQuestion('How to open File Explorer?')">Open File Explorer</button>
                            <button class="secondary" onclick="os.aiQuickQuestion('What games are available?')">Available Games</button>
                            <button class="secondary" onclick="os.aiQuickQuestion('How to lock the system?')">Lock System</button>
                        </div>
                    </div>
                `;
            }
            
            sendAIMessage() {
                const input = document.getElementById('aiInput');
                const chat = document.getElementById('aiChat');
                
                if (!input || !chat || !input.value.trim()) return;
                
                const message = input.value;
                input.value = '';
                
                // Add user message
                chat.innerHTML += `<div class="ai-message ai-user">${message}</div>`;
                
                // Simulate AI thinking
                setTimeout(() => {
                    const response = this.getAIResponse(message);
                    chat.innerHTML += `<div class="ai-message ai-bot">${response}</div>`;
                    chat.scrollTop = chat.scrollHeight;
                }, 500);
            }
            
            getAIResponse(message) {
                const lower = message.toLowerCase();
                
                if (lower.includes('wallpaper') || lower.includes('background')) {
                    return "To change your wallpaper, open Settings > Personalization > Wallpaper. You can choose from default, nature, abstract, or gradient wallpapers.";
                } else if (lower.includes('file explorer') || lower.includes('files')) {
                    return "You can open File Explorer by double-clicking the üìÅ icon on your desktop or selecting it from the Start Menu. It lets you browse files and folders.";
                } else if (lower.includes('game') || lower.includes('play')) {
                    return "BhekOS has several games: Snake, Flappy Bird, Memory Match, 2048, Puzzle, and Tic Tac Toe. Open Game Center from the Start Menu to play.";
                } else if (lower.includes('lock') || lower.includes('password')) {
                    return "To lock your system, you can click the power button in Start Menu and select 'Lock', or press Ctrl+Alt+L. Set up password protection in Settings > Security.";
                } else if (lower.includes('setting') || lower.includes('configure')) {
                    return "Settings can be accessed from the Start Menu or the ‚öôÔ∏è icon on desktop. You'll find options for personalization, security, system, network, accessibility, and user accounts.";
                } else if (lower.includes('browser') || lower.includes('internet')) {
                    return "The web browser can be opened from the üåê icon. It supports tabs, bookmarks, and secure browsing. Try visiting google.com, github.com, or wikipedia.org.";
                } else if (lower.includes('terminal') || lower.includes('command')) {
                    return "The terminal provides command-line access. Type 'help' to see available commands. You can navigate files, check system status, and launch games.";
                } else if (lower.includes('hello') || lower.includes('hi')) {
                    return "Hello! I'm BhekAI, ready to help you with BhekOS. What would you like to know?";
                } else if (lower.includes('thank')) {
                    return "You're welcome! Let me know if you need anything else.";
                } else {
                    return "I understand you're asking about '" + message + "'. For detailed help, please check the relevant section in Settings or consult the user manual. Is there anything specific about BhekOS you'd like to know?";
                }
            }
            
            aiQuickQuestion(question) {
                const input = document.getElementById('aiInput');
                if (input) {
                    input.value = question;
                    this.sendAIMessage();
                }
            }
            
            // ==================== WORKING NOTEPAD ====================
            loadNotepad(view) {
                const savedContent = localStorage.getItem('notepadContent') || 'Welcome to BhekOS Notepad!\n\nYou can type here and your content will be automatically saved.\n\nFeatures:\n‚Ä¢ Auto-save\n‚Ä¢ Multiple files\n‚Ä¢ Basic formatting\n‚Ä¢ Word count';
                
                view.innerHTML = `
                    <div style="display: flex; flex-direction: column; height: 100%;">
                        <div style="display: flex; gap: 8px; padding: 12px; background: rgba(0,0,0,0.2); border-bottom: 1px solid var(--mica-border);">
                            <button onclick="os.notepadNew()">New</button>
                            <button onclick="os.notepadSave()">Save</button>
                            <button onclick="os.notepadOpen()">Open</button>
                            <button onclick="os.notepadPrint()" class="secondary">Print</button>
                            <div style="flex: 1;"></div>
                            <div id="wordCount" style="font-size: 12px; opacity: 0.8; align-self: center;">
                                Words: 0 | Characters: 0
                            </div>
                        </div>
                        <textarea id="notepadTextarea" 
                                  style="flex: 1; background: transparent; border: none; color: white; 
                                         padding: 16px; font-family: 'Consolas', monospace; font-size: 14px; 
                                         resize: none; outline: none;"
                                  oninput="os.updateWordCount()">${savedContent}</textarea>
                    </div>
                `;
                
                this.updateWordCount();
            }
            
            notepadNew() {
                if (confirm('Create new document? Unsaved changes will be lost.')) {
                    document.getElementById('notepadTextarea').value = '';
                    this.updateWordCount();
                    this.notify('Notepad', 'New document created');
                }
            }
            
            notepadSave() {
                const content = document.getElementById('notepadTextarea').value;
                localStorage.setItem('notepadContent', content);
                
                // Create a blob and download
                const blob = new Blob([content], {type: 'text/plain'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'document.txt';
                a.click();
                
                this.notify('Notepad', 'Document saved successfully');
            }
            
            notepadOpen() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.txt,.text,.md';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('notepadTextarea').value = e.target.result;
                        this.updateWordCount();
                        this.notify('Notepad', `Opened: ${file.name}`);
                    };
                    reader.readAsText(file);
                };
                input.click();
            }
            
            notepadPrint() {
                window.print();
            }
            
            updateWordCount() {
                const textarea = document.getElementById('notepadTextarea');
                if (!textarea) return;
                
                const text = textarea.value;
                const words = text.trim() ? text.trim().split(/\s+/).length : 0;
                const chars = text.length;
                
                const wordCount = document.getElementById('wordCount');
                if (wordCount) {
                    wordCount.textContent = `Words: ${words} | Characters: ${chars}`;
                }
            }
            
            // ==================== WORKING CALCULATOR ====================
            loadCalculator(view) {
                view.innerHTML = `
                    <div style="display: flex; flex-direction: column; height: 100%; padding: 20px;">
                        <div id="calcDisplay" 
                             style="background: rgba(0,0,0,0.5); border-radius: 8px; padding: 20px; 
                                    font-size: 32px; text-align: right; margin-bottom: 20px; 
                                    min-height: 60px; overflow: hidden; font-family: monospace;">
                            0
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; flex: 1;">
                            <button style="background: #FF5252;" onclick="os.calcClear()">C</button>
                            <button style="background: rgba(255,255,255,0.2);" onclick="os.calcInput('(')">(</button>
                            <button style="background: rgba(255,255,255,0.2);" onclick="os.calcInput(')')">)</button>
                            <button style="background: #2196F3;" onclick="os.calcInput('/')">√∑</button>
                            
                            <button onclick="os.calcInput('7')">7</button>
                            <button onclick="os.calcInput('8')">8</button>
                            <button onclick="os.calcInput('9')">9</button>
                            <button style="background: #2196F3;" onclick="os.calcInput('*')">√ó</button>
                            
                            <button onclick="os.calcInput('4')">4</button>
                            <button onclick="os.calcInput('5')">5</button>
                            <button onclick="os.calcInput('6')">6</button>
                            <button style="background: #2196F3;" onclick="os.calcInput('-')">-</button>
                            
                            <button onclick="os.calcInput('1')">1</button>
                            <button onclick="os.calcInput('2')">2</button>
                            <button onclick="os.calcInput('3')">3</button>
                            <button style="background: #2196F3;" onclick="os.calcInput('+')">+</button>
                            
                            <button onclick="os.calcInput('0')">0</button>
                            <button onclick="os.calcInput('.')">.</button>
                            <button onclick="os.calcBackspace()">‚å´</button>
                            <button style="background: #4CAF50;" onclick="os.calcCalculate()">=</button>
                        </div>
                        
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="secondary" onclick="os.calcScientific()">Scientific</button>
                            <button class="secondary" onclick="os.calcHistory()">History</button>
                            <button class="secondary" onclick="os.calcCopy()">Copy Result</button>
                        </div>
                    </div>
                `;
                
                this.calcValue = '0';
                this.calcHistory = [];
            }
            
            calcInput(value) {
                const display = document.getElementById('calcDisplay');
                if (!display) return;
                
                if (this.calcValue === '0' && !'+-*/.'.includes(value)) {
                    this.calcValue = value;
                } else {
                    this.calcValue += value;
                }
                
                display.textContent = this.calcValue;
            }
            
            calcClear() {
                this.calcValue = '0';
                const display = document.getElementById('calcDisplay');
                if (display) display.textContent = '0';
            }
            
            calcBackspace() {
                if (this.calcValue.length > 1) {
                    this.calcValue = this.calcValue.slice(0, -1);
                } else {
                    this.calcValue = '0';
                }
                const display = document.getElementById('calcDisplay');
                if (display) display.textContent = this.calcValue;
            }
            
            calcCalculate() {
                try {
                    // Replace display symbols with JavaScript operators
                    let expression = this.calcValue
                        .replace(/√ó/g, '*')
                        .replace(/√∑/g, '/');
                    
                    // Evaluate safely
                    const result = Function('"use strict"; return (' + expression + ')')();
                    
                    // Store in history
                    this.calcHistory.push(`${this.calcValue} = ${result}`);
                    if (this.calcHistory.length > 10) this.calcHistory.shift();
                    
                    this.calcValue = result.toString();
                    const display = document.getElementById('calcDisplay');
                    if (display) display.textContent = this.calcValue;
                    
                } catch (error) {
                    this.calcValue = 'Error';
                    const display = document.getElementById('calcDisplay');
                    if (display) display.textContent = 'Error';
                }
            }
            
            // ==================== WORKING PAINT ====================
            loadPaint(view) {
                view.innerHTML = `
                    <div style="display: flex; flex-direction: column; height: 100%;">
                        <div style="display: flex; gap: 8px; padding: 12px; background: rgba(0,0,0,0.2); border-bottom: 1px solid var(--mica-border);">
                            <button onclick="os.paintNew()">New</button>
                            <button onclick="os.paintSave()">Save</button>
                            <button onclick="os.paintOpen()">Open</button>
                            <select id="paintTool" onchange="os.paintChangeTool(this.value)" style="margin-left: auto;">
                                <option value="brush">Brush</option>
                                <option value="line">Line</option>
                                <option value="rectangle">Rectangle</option>
                                <option value="circle">Circle</option>
                                <option value="eraser">Eraser</option>
                            </select>
                            <input type="color" id="paintColor" value="#ff0000" onchange="os.paintChangeColor(this.value)">
                            <input type="range" id="paintSize" min="1" max="50" value="5" onchange="os.paintChangeSize(this.value)">
                        </div>
                        
                        <div style="display: flex; flex: 1;">
                            <canvas id="paintCanvas" 
                                    style="background: white; flex: 1; cursor: crosshair; border: 1px solid var(--mica-border);">
                            </canvas>
                            
                            <div style="width: 200px; padding: 16px; background: rgba(0,0,0,0.2); border-left: 1px solid var(--mica-border);">
                                <h4 style="margin-bottom: 12px;">Tools</h4>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                    <button class="secondary" onclick="os.paintSetTool('brush')">üñåÔ∏è Brush</button>
                                    <button class="secondary" onclick="os.paintSetTool('line')">üìè Line</button>
                                    <button class="secondary" onclick="os.paintSetTool('rectangle')">‚¨ú Rectangle</button>
                                    <button class="secondary" onclick="os.paintSetTool('circle')">‚≠ï Circle</button>
                                    <button class="secondary" onclick="os.paintSetTool('eraser')">üßΩ Eraser</button>
                                    <button class="secondary" onclick="os.paintClear()">üóëÔ∏è Clear</button>
                                </div>
                                
                                <div style="margin-top: 20px;">
                                    <h4 style="margin-bottom: 8px;">Colors</h4>
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px;">
                                        ${['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#000000', '#ffffff',
                                           '#ff8800', '#88ff00', '#0088ff', '#8800ff', '#ff0088', '#00ff88', '#888888', '#ff8888']
                                          .map(color => `
                                            <div style="width: 30px; height: 30px; background: ${color}; cursor: pointer; border-radius: 4px;"
                                                 onclick="os.paintChangeColor('${color}')"></div>
                                          `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                setTimeout(() => this.initPaintCanvas(), 100);
            }
            
            initPaintCanvas() {
                const canvas = document.getElementById('paintCanvas');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                
                // Clear canvas to white
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                let painting = false;
                let startX, startY;
                let currentTool = 'brush';
                let currentColor = '#ff0000';
                let brushSize = 5;
                
                const getMousePos = (e) => {
                    const rect = canvas.getBoundingClientRect();
                    return {
                        x: e.clientX - rect.left,
                        y: e.clientY - rect.top
                    };
                };
                
                const startPainting = (e) => {
                    painting = true;
                    const pos = getMousePos(e);
                    startX = pos.x;
                    startY = pos.y;
                    
                    if (currentTool === 'brush' || currentTool === 'eraser') {
                        draw(pos.x, pos.y);
                    }
                };
                
                const stopPainting = () => {
                    painting = false;
                    ctx.beginPath();
                };
                
                const draw = (x, y) => {
                    if (!painting) return;
                    
                    ctx.lineWidth = brushSize;
                    ctx.lineCap = 'round';
                    
                    if (currentTool === 'eraser') {
                        ctx.strokeStyle = '#ffffff';
                    } else {
                        ctx.strokeStyle = currentColor;
                    }
                    
                    if (currentTool === 'brush' || currentTool === 'eraser') {
                        ctx.lineTo(x, y);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                    }
                };
                
                const drawShape = (x, y) => {
                    if (!painting) return;
                    
                    // Clear canvas and redraw
                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCanvas.width = canvas.width;
                    tempCanvas.height = canvas.height;
                    tempCtx.drawImage(canvas, 0, 0);
                    
                    // Clear and restore
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(tempCanvas, 0, 0);
                    
                    // Draw new shape
                    ctx.strokeStyle = currentColor;
                    ctx.lineWidth = brushSize;
                    
                    switch(currentTool) {
                        case 'line':
                            ctx.beginPath();
                            ctx.moveTo(startX, startY);
                            ctx.lineTo(x, y);
                            ctx.stroke();
                            break;
                            
                        case 'rectangle':
                            ctx.strokeRect(startX, startY, x - startX, y - startY);
                            break;
                            
                        case 'circle':
                            const radius = Math.sqrt(Math.pow(x - startX, 2) + Math.pow(y - startY, 2));
                            ctx.beginPath();
                            ctx.arc(startX, startY, radius, 0, Math.PI * 2);
                            ctx.stroke();
                            break;
                    }
                };
                
                canvas.addEventListener('mousedown', startPainting);
                canvas.addEventListener('mouseup', stopPainting);
                canvas.addEventListener('mousemove', (e) => {
                    const pos = getMousePos(e);
                    if (currentTool === 'brush' || currentTool === 'eraser') {
                        draw(pos.x, pos.y);
                    } else {
                        drawShape(pos.x, pos.y);
                    }
                });
                
                window.os.paintSetTool = (tool) => {
                    currentTool = tool;
                    document.getElementById('paintTool').value = tool;
                };
                
                window.os.paintChangeTool = (tool) => {
                    currentTool = tool;
                };
                
                window.os.paintChangeColor = (color) => {
                    currentColor = color;
                    document.getElementById('paintColor').value = color;
                };
                
                window.os.paintChangeSize = (size) => {
                    brushSize = parseInt(size);
                };
                
                window.os.paintClear = () => {
                    if (confirm('Clear canvas?')) {
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                    }
                };
                
                window.os.paintSave = () => {
                    const link = document.createElement('a');
                    link.download = 'bhekos-painting.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    os.notify('Paint', 'Image saved successfully');
                };
                
                window.os.paintNew = () => {
                    if (confirm('Start new painting?')) {
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                    }
                };
                
                window.os.paintOpen = () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'image/*';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = new Image();
                            img.onload = () => {
                                ctx.clearRect(0, 0, canvas.width, canvas.height);
                                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                            };
                            img.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    };
                    input.click();
                };
            }
            
            // ==================== UTILITY FUNCTIONS ====================
            updateClock() {
                const now = new Date();
                const time = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const date = now.toLocaleDateString();
                const clock = document.getElementById('clock');
                if (clock) {
                    clock.textContent = time;
                    clock.title = date;
                }
            }
            
            notify(title, message) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.innerHTML = `
                    <strong>${title}</strong>
                    <p>${message}</p>
                `;
                
                document.getElementById('desktop').appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('fadeout');
                    setTimeout(() => notification.remove(), 3000);
                }, 2000);
            }
            
            showContextMenu(e) {
                e.preventDefault();
                
                const menu = document.getElementById('contextMenu');
                menu.innerHTML = `
                    <div class="context-menu-item" onclick="os.createNewFolder()">
                        üìÅ New Folder
                    </div>
                    <div class="context-menu-item" onclick="os.createNewTextFile()">
                        üìÑ New Text File
                    </div>
                    <div class="context-menu-item" onclick="os.changeWallpaper()">
                        üñºÔ∏è Change Wallpaper
                    </div>
                    <div class="context-menu-item" onclick="os.openSettings()">
                        ‚öôÔ∏è Settings
                    </div>
                    <div class="context-menu-item" onclick="os.refreshDesktop()">
                        üîÑ Refresh
                    </div>
                    <div class="context-menu-item" onclick="os.lockScreen()">
                        üîê Lock
                    </div>
                `;
                
                menu.style.left = e.clientX + 'px';
                menu.style.top = e.clientY + 'px';
                menu.style.display = 'flex';
                
                // Close menu when clicking elsewhere
                setTimeout(() => {
                    document.addEventListener('click', () => {
                        menu.style.display = 'none';
                    }, { once: true });
                }, 100);
            }
            
            lockScreen() {
                const lockScreen = document.getElementById('lock-screen');
                if (!lockScreen) return;
                
                lockScreen.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üîí</div>
                        <h1 style="margin-bottom: 10px;">BhekOS</h1>
                        <p style="margin-bottom: 30px; opacity: 0.8;">${this.currentUser}</p>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; max-width: 300px; margin: 0 auto;">
                            <input type="password" id="lockPassword" placeholder="Password" 
                                   style="width: 100%; padding: 12px; margin-bottom: 12px;"
                                   onkeydown="if(event.key === 'Enter') os.unlock()">
                            <button onclick="os.unlock()" style="width: 100%; padding: 12px;">
                                Unlock
                            </button>
                        </div>
                        
                        <p style="margin-top: 30px; font-size: 12px; opacity: 0.6;">
                            Press Ctrl+Alt+Del for more options
                        </p>
                    </div>
                `;
                
                lockScreen.style.display = 'flex';
            }
            
            unlock() {
                const password = document.getElementById('lockPassword').value;
                // In a real system, you would validate against stored password
                if (password === 'admin' || password === '1234') {
                    document.getElementById('lock-screen').style.display = 'none';
                    this.notify('System', 'Welcome back!');
                } else {
                    alert('Incorrect password');
                }
            }
            
            shutdown() {
                const shutdownScreen = document.getElementById('shutdown-screen');
                if (!shutdownScreen) return;
                
                shutdownScreen.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 64px; margin-bottom: 20px;">‚èª</div>
                        <h1 style="margin-bottom: 10px;">Shut Down BhekOS</h1>
                        <p style="margin-bottom: 40px; opacity: 0.8;">What do you want to do?</p>
                        
                        <div class="shutdown-options">
                            <button style="background: #4CAF50;" onclick="os.restart()">
                                üîÑ Restart
                            </button>
                            <button style="background: #FF5252;" onclick="os.confirmShutdown()">
                                ‚èª Shut Down
                            </button>
                            <button style="background: #FF9800;" onclick="os.cancelShutdown()">
                                Cancel
                            </button>
                        </div>
                        
                        <div style="margin-top: 40px; display: flex; gap: 20px; justify-content: center;">
                            <button class="secondary" onclick="os.sleep()">Sleep</button>
                            <button class="secondary" onclick="os.lockScreen()">Lock</button>
                            <button class="secondary" onclick="os.switchUser()">Switch User</button>
                        </div>
                    </div>
                `;
                
                shutdownScreen.style.display = 'flex';
            }
            
            confirmShutdown() {
                document.getElementById('shutdown-screen').innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 64px; margin-bottom: 20px;">‚èª</div>
                        <h1 style="margin-bottom: 10px;">Shutting Down</h1>
                        <p style="margin-bottom: 20px; opacity: 0.8;">Saving your work...</p>
                        <div style="width: 200px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin: 0 auto;">
                            <div id="shutdown-progress" style="width: 0%; height: 100%; background: var(--accent); border-radius: 2px; transition: width 3s;"></div>
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    document.getElementById('shutdown-progress').style.width = '100%';
                }, 100);
                
                setTimeout(() => {
                    document.body.innerHTML = `
                        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: black; color: white; font-family: monospace;">
                            <div style="text-align: center;">
                                <div style="font-size: 48px; margin-bottom: 20px;">üñ•Ô∏è</div>
                                <h1>BhekOS is now safe to turn off</h1>
                                <p style="opacity: 0.8; margin-top: 10px;">Press any key to restart</p>
                            </div>
                        </div>
                    `;
                    
                    document.addEventListener('keydown', () => location.reload());
                }, 4000);
            }
            
            cancelShutdown() {
                document.getElementById('shutdown-screen').style.display = 'none';
            }
            
            restart() {
                this.notify('System', 'Restarting...');
                setTimeout(() => location.reload(), 1000);
            }
            
            sleep() {
                document.getElementById('shutdown-screen').style.display = 'none';
                this.notify('System', 'Entering sleep mode');
                setTimeout(() => {
                    document.getElementById('desktop').style.filter = 'brightness(0.3)';
                    setTimeout(() => {
                        document.getElementById('desktop').style.filter = '';
                        this.notify('System', 'Welcome back!');
                    }, 2000);
                }, 1000);
            }
            
            setupPWAInstall() {
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    this.deferredPrompt = e;
                    this.showInstallPrompt();
                });
            }
            
            showInstallPrompt() {
                if (!this.deferredPrompt) return;
                
                const prompt = document.getElementById('install-prompt');
                prompt.innerHTML = `
                    <h4>üì± Install BhekOS</h4>
                    <p style="margin: 8px 0; font-size: 13px;">Install BhekOS as an app for a better experience</p>
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button onclick="os.installPWA()" style="flex: 1;">Install</button>
                        <button class="secondary" onclick="this.parentElement.style.display='none'">Not Now</button>
                    </div>
                `;
                prompt.style.display = 'block';
                
                setTimeout(() => {
                    prompt.style.display = 'none';
                }, 10000);
            }
            
            installPWA() {
                if (this.deferredPrompt) {
                    this.deferredPrompt.prompt();
                    this.deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            this.notify('PWA', 'BhekOS installed successfully!');
                        }
                        this.deferredPrompt = null;
                        document.getElementById('install-prompt').style.display = 'none';
                    });
                }
            }
            
            registerServiceWorker() {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('sw.js').catch(err => {
                        console.log('Service Worker registration failed:', err);
                    });
                }
            }
            
            initIconSettingsIfNeeded() {
                if (!localStorage.getItem('iconSettings')) {
                    const defaultSettings = {
                        explorer: { emoji: 'üìÅ', color: '#4CAF50', size: 32, bgOpacity: 20 },
                        terminal: { emoji: 'üíª', color: '#2196F3', size: 32, bgOpacity: 20 },
                        browser: { emoji: 'üåê', color: '#FF9800', size: 32, bgOpacity: 20 },
                        media: { emoji: 'üéµ', color: '#9C27B0', size: 32, bgOpacity: 20 },
                        settings: { emoji: '‚öôÔ∏è', color: '#607D8B', size: 32, bgOpacity: 20 },
                        games: { emoji: 'üéÆ', color: '#E91E63', size: 32, bgOpacity: 20 },
                        ai: { emoji: 'ü§ñ', color: '#00BCD4', size: 32, bgOpacity: 20 },
                        notepad: { emoji: 'üìù', color: '#009688', size: 32, bgOpacity: 20 },
                        calculator: { emoji: 'üßÆ', color: '#FF5722', size: 32, bgOpacity: 20 },
                        paint: { emoji: 'üé®', color: '#8BC34A', size: 32, bgOpacity: 20 }
                    };
                    localStorage.setItem('iconSettings', JSON.stringify(defaultSettings));
                }
            }
            
            initSecuritySettingsIfNeeded() {
                if (!localStorage.getItem('securitySettings')) {
                    const defaultSettings = {
                        requirePassword: false,
                        autoLock: 5,
                        requirePasswordForApps: false
                    };
                    localStorage.setItem('securitySettings', JSON.stringify(defaultSettings));
                }
            }
            
            resetAutoLockTimer() {
                if (this.autoLockTimer) clearTimeout(this.autoLockTimer);
                
                const security = JSON.parse(localStorage.getItem('securitySettings') || '{}');
                if (security.autoLock && security.autoLock > 0) {
                    this.autoLockTimer = setTimeout(() => {
                        this.lockScreen();
                    }, security.autoLock * 60 * 1000);
                }
            }
            
            resetInactivityTimer() {
                if (this.inactivityTimer) clearTimeout(this.inactivityTimer);
                
                const security = JSON.parse(localStorage.getItem('securitySettings') || '{}');
                if (security.autoLock && security.autoLock > 0) {
                    this.inactivityTimer = setTimeout(() => {
                        this.lockScreen();
                    }, security.autoLock * 60 * 1000);
                }
            }
            
            setupInactivityMonitoring() {
                const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
                events.forEach(event => {
                    document.addEventListener(event, () => {
                        this.resetInactivityTimer();
                    });
                });
            }
            
            checkAutoLockOnStart() {
                const security = JSON.parse(localStorage.getItem('securitySettings') || '{}');
                if (security.requirePassword) {
                    setTimeout(() => this.lockScreen(), 1000);
                }
            }
            
            requiresPasswordForApp(appId) {
                const security = JSON.parse(localStorage.getItem('securitySettings') || '{}');
                const sensitiveApps = ['settings', 'files', 'browser', 'ai'];
                return security.requirePasswordForApps && sensitiveApps.includes(appId);
            }
            
            showAppPasswordPrompt(appId, appName) {
                const password = prompt(`Enter password to open ${appName}:`, '');
                // In a real system, validate against stored password
                if (password === 'admin' || password === '1234') {
                    this.spawn(appName, appId);
                } else {
                    this.notify('Security', 'Access denied');
                }
            }
            
            showGamePasswordPrompt(gameType) {
                const password = prompt('Enter password to play games:', '');
                if (password === 'admin' || password === '1234') {
                    this.launchGame(gameType);
                } else {
                    this.notify('Security', 'Access denied');
                }
            }
            
            togglePasswordProtection(enabled) {
                const security = JSON.parse(localStorage.getItem('securitySettings') || '{}');
                security.requirePassword = enabled;
                localStorage.setItem('securitySettings', JSON.stringify(security));
                this.notify('Security', `Password protection ${enabled ? 'enabled' : 'disabled'}`);
            }
            
            toggleAppPasswordProtection(enabled) {
                const security = JSON.parse(localStorage.getItem('securitySettings') || '{}');
                security.requirePasswordForApps = enabled;
                localStorage.setItem('securitySettings', JSON.stringify(security));
                this.notify('Security', `App password protection ${enabled ? 'enabled' : 'disabled'}`);
            }
            
            changeAutoLock(minutes) {
                const security = JSON.parse(localStorage.getItem('securitySettings') || '{}');
                security.autoLock = parseInt(minutes);
                localStorage.setItem('securitySettings', JSON.stringify(security));
                this.resetAutoLockTimer();
                this.notify('Security', `Auto lock set to ${minutes} minutes`);
            }
            
            toggleGamePasswords(enabled) {
                const security = JSON.parse(localStorage.getItem('securitySettings') || '{}');
                security.requirePasswordForGames = enabled;
                localStorage.setItem('securitySettings', JSON.stringify(security));
                this.notify('Games', `Password requirement ${enabled ? 'enabled' : 'disabled'}`);
            }
            
            getIconSettings() {
                const savedSettings = JSON.parse(localStorage.getItem('iconSettings') || '{}');
                const apps = [
                    { id: 'explorer', name: 'File Explorer', defaultEmoji: 'üìÅ', defaultColor: '#4CAF50' },
                    { id: 'terminal', name: 'Terminal', defaultEmoji: 'üíª', defaultColor: '#2196F3' },
                    { id: 'browser', name: 'Web Browser', defaultEmoji: 'üåê', defaultColor: '#FF9800' },
                    { id: 'media', name: 'Media Player', defaultEmoji: 'üéµ', defaultColor: '#9C27B0' },
                    { id: 'settings', name: 'Settings', defaultEmoji: '‚öôÔ∏è', defaultColor: '#607D8B' },
                    { id: 'games', name: 'Game Center', defaultEmoji: 'üéÆ', defaultColor: '#E91E63' },
                    { id: 'ai', name: 'BhekAI', defaultEmoji: 'ü§ñ', defaultColor: '#00BCD4' },
                    { id: 'notepad', name: 'Notepad', defaultEmoji: 'üìù', defaultColor: '#009688' },
                    { id: 'calculator', name: 'Calculator', defaultEmoji: 'üßÆ', defaultColor: '#FF5722' },
                    { id: 'paint', name: 'Paint', defaultEmoji: 'üé®', defaultColor: '#8BC34A' }
                ];
                
                return `
                    <div style="margin-bottom: 20px;">
                        <p style="opacity: 0.8; margin-bottom: 16px;">Customize desktop and start menu icons</p>
                        <div id="icon-settings-list">
                            ${apps.map(app => {
                                const settings = savedSettings[app.id] || {};
                                const emoji = settings.emoji || app.defaultEmoji;
                                const color = settings.color || app.defaultColor;
                                const size = settings.size || 32;
                                const bgOpacity = settings.bgOpacity || 20;
                                
                                return `
                                    <div class="apple-settings-item">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="
                                                width: 40px;
                                                height: 40px;
                                                display: flex;
                                                align-items: center;
                                                justify-content: center;
                                                background: ${color}${Math.round(bgOpacity * 2.55).toString(16).padStart(2, '0')};
                                                border-radius: 8px;
                                                font-size: ${size}px;
                                            ">${emoji}</div>
                                            <div>
                                                <div style="font-weight: 500;">${app.name}</div>
                                                <div style="font-size: 12px; opacity: 0.8;">Icon customization</div>
                                            </div>
                                        </div>
                                        <button class="secondary" onclick="os.editIcon('${app.id}')">Edit</button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    <div style="margin-top: 20px; padding: 16px; background: rgba(var(--accent-rgb), 0.1); border-radius: 8px;">
                        <h4>Icon Grid Size</h4>
                        <select onchange="os.changeIconGrid(this.value)" style="width: 100%; margin-top: 8px;">
                            <option value="small">Small icons</option>
                            <option value="medium" selected>Medium icons</option>
                            <option value="large">Large icons</option>
                        </select>
                        <p style="font-size: 12px; margin-top: 8px; opacity: 0.8;">Changes will apply after restart</p>
                    </div>
                `;
            }
            
            editIcon(appId) {
                const savedSettings = JSON.parse(localStorage.getItem('iconSettings') || '{}');
                const settings = savedSettings[appId] || {};
                
                const newEmoji = prompt('Enter new emoji:', settings.emoji || 'üìÅ');
                if (newEmoji) {
                    settings.emoji = newEmoji;
                }
                
                const newColor = prompt('Enter hex color (e.g., #4CAF50):', settings.color || '#4CAF50');
                if (newColor) {
                    settings.color = newColor;
                }
                
                const newSize = prompt('Icon size (24-48):', settings.size || 32);
                if (newSize) {
                    settings.size = parseInt(newSize);
                }
                
                savedSettings[appId] = settings;
                localStorage.setItem('iconSettings', JSON.stringify(savedSettings));
                
                // Update desktop icons and start menu
                this.initDesktopIcons();
                this.initStartMenu();
                
                this.notify('Settings', 'Icon updated');
            }
        }
        
        // Initialize BhekOS
        const os = new BhekOS();
        
        // Make OS globally available
        window.os = os;
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl+Alt+L: Lock
            if (e.ctrlKey && e.altKey && e.key === 'L') {
                e.preventDefault();
                os.lockScreen();
            }
            
            // Ctrl+Alt+Delete: Task Manager (simulated)
            if (e.ctrlKey && e.altKey && e.key === 'Delete') {
                e.preventDefault();
                os.notify('Security', 'Ctrl+Alt+Delete pressed - Opening Security Options');
            }
            
            // Alt+F4: Close active window
            if (e.altKey && e.key === 'F4') {
                e.preventDefault();
                const activeWindow = document.querySelector('.window[style*="z-index: 100"]');
                if (activeWindow) {
                    const pid = activeWindow.id;
                    os.kill(pid);
                }
            }
            
            // Windows key (Meta): Toggle start menu
            if (e.key === 'Meta' || e.key === 'Super') {
                e.preventDefault();
                os.toggleStart();
            }
            
            // Escape: Close start menu or context menu
            if (e.key === 'Escape') {
                document.getElementById('startMenu').style.display = 'none';
                document.getElementById('contextMenu').style.display = 'none';
            }
        });
    </script>
</body>
</html>
